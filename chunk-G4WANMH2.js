import{a as F}from"./chunk-PKO5ZNGR.js";import{a as Q,b as z}from"./chunk-NLDPNQFE.js";import{$ as P,A as g,B as p,C as r,D as a,E as x,K as y,M as b,O as h,P as D,Q as M,R as O,T as _,U as c,W as u,Z as f,aa as R,ba as T,g as w,ga as N,h as C,o as d,r as k,s as E,u as i,x as v,y as S}from"./chunk-NSEKHPH4.js";import"./chunk-C6Q5SG76.js";var A=["fogCanvas"];function j(o,t){if(o&1){let n=y();r(0,"button",16),b("click",function(){let s=w(n).$implicit,l=h();return C(l.selectOption(s))}),c(1),a()}if(o&2){let n=t.$implicit,e=h();_("bg-pink-500",e.selectedOption()===n)("text-white",e.selectedOption()===n)("bg-white",e.selectedOption()!==n),p("disabled",e.isLevelComplete()),i(),u(" ",n," ")}}function H(o,t){if(o&1&&(r(0,"div",17),c(1),a()),o&2){let n=h();i(),u(" ",n.feedbackMessage()," ")}}function B(o,t){o&1&&(r(0,"div",18)(1,"p"),c(2,"The Forest is foggy..."),a()())}function W(o,t){if(o&1){let n=y();r(0,"app-level-completion",19),b("onContinue",function(){w(n);let s=h();return C(s.continueToNextLevel())}),a()}}var q=class o{constructor(t,n,e){this.router=t;this.gameState=n;this.assetLoader=e}canvasRef;fogCleared=d(!1);selectedOption=d(null);feedbackMessage=d("");isLevelComplete=d(!1);showCompletion=d(!1);isProcessing=!1;currentQuestionIndex=d(0);questions=[{text:"If your mind gets loud, I\u2019ll bring you back to _____.",options:["peace","certainty","control"],correct:"peace"},{text:"Even on messy days, my love stays _____.",options:["steady","intense","protective"],correct:"steady"},{text:"You don\u2019t need to earn love. You deserve it _____.",options:["as you are","when you grow","when you try"],correct:"as you are"},{text:"When you doubt yourself, I\u2019ll remind you what\u2019s _____.",options:["real","possible","important"],correct:"real"},{text:"If something feels off, you\u2019re allowed to choose _____.",options:["distance","patience","understanding"],correct:"distance"},{text:"No matter what, you are _____.",options:["loved","valued","chosen"],correct:"loved"}];currentQuestion=f(()=>this.questions[this.currentQuestionIndex()]);questionParts=f(()=>{let n=this.currentQuestion().text.split("_____");return{start:n[0],end:n[1]||""}});currentOptions=f(()=>this.currentQuestion().options);ctx;isDrawing=!1;companionImage=f(()=>{let t=this.gameState.companion(),n=this.gameState.mood(),e="idle";switch(n){case"Soft":e="idle";break;case"Boss":e="victorious";break;case"Mischief":e="happy";break;case"Overthink":e="thinking";break;default:e="idle"}return this.assetLoader.getCharacterImage(t,e)});ngOnInit(){this.gameState.currentLevel.set(2)}ngAfterViewInit(){this.initCanvas()}initCanvas(){let t=this.canvasRef.nativeElement;this.ctx=t.getContext("2d",{willReadFrequently:!0}),this.resizeCanvas(),this.drawFog(),t.addEventListener("mousedown",this.startDrawing.bind(this)),t.addEventListener("mousemove",this.draw.bind(this)),t.addEventListener("mouseup",this.stopDrawing.bind(this)),t.addEventListener("touchstart",this.startDrawing.bind(this),{passive:!1}),t.addEventListener("touchmove",this.draw.bind(this),{passive:!1}),t.addEventListener("touchend",this.stopDrawing.bind(this))}resizeCanvas(){if(!this.canvasRef)return;let t=this.canvasRef.nativeElement;t.width=window.innerWidth,t.height=window.innerHeight,this.fogCleared()||this.drawFog()}drawFog(){this.ctx.fillStyle="#9ca3af",this.ctx.fillRect(0,0,this.canvasRef.nativeElement.width,this.canvasRef.nativeElement.height),this.ctx.font="30px sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",this.ctx.fillText("Can't see clearly...",this.canvasRef.nativeElement.width/2,this.canvasRef.nativeElement.height/2)}startDrawing(t){t.preventDefault(),this.isDrawing=!0,this.draw(t)}stopDrawing(){this.isDrawing=!1,this.checkFogClearance()}draw(t){if(!this.isDrawing||this.fogCleared())return;t.preventDefault();let e=this.canvasRef.nativeElement.getBoundingClientRect(),s,l;t instanceof MouseEvent?(s=t.clientX-e.left,l=t.clientY-e.top):(s=t.touches[0].clientX-e.left,l=t.touches[0].clientY-e.top),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(s,l,40,0,Math.PI*2),this.ctx.fill()}checkFogClearance(){if(this.fogCleared())return;let t=this.canvasRef.nativeElement,n=t.width,e=t.height,l=this.ctx.getImageData(0,0,n,e).data,I=0,L=50;for(let m=0;m<l.length;m+=4*L)l[m+3]===0&&I++;let V=l.length/(4*L);if(I/V>.4){this.fogCleared.set(!0);let m=document.querySelector(".content-container");m&&m.classList.add("interactive")}}selectOption(t){if(this.isLevelComplete()||this.isProcessing)return;this.isProcessing=!0,this.selectedOption.set(t);let n=this.currentQuestion();t===n.correct?this.currentQuestionIndex()<this.questions.length-1?setTimeout(()=>{this.selectedOption.set(null),this.currentQuestionIndex.update(e=>e+1),this.isProcessing=!1},1e3):setTimeout(()=>{this.handleWin()},1e3):(this.gameState.decreaseLife(),this.feedbackMessage.set("Try again... that feels off."),setTimeout(()=>{this.feedbackMessage.set(""),this.selectedOption.set(null),this.isProcessing=!1},1e3))}handleWin(){this.isLevelComplete.set(!0),this.feedbackMessage.set(""),this.gameState.addToInventory("Show-Up Shield"),setTimeout(()=>{this.showCompletion.set(!0)},1500)}continueToNextLevel(){this.router.navigate(["/valentine/level-3"])}static \u0275fac=function(n){return new(n||o)(v(N),v(Q),v(z))};static \u0275cmp=S({type:o,selectors:[["app-level-2"]],viewQuery:function(n,e){if(n&1&&D(A,5),n&2){let s;M(s=O())&&(e.canvasRef=s.first)}},hostBindings:function(n,e){n&1&&b("resize",function(){return e.resizeCanvas()},E)},decls:20,vars:17,consts:[["fogCanvas",""],[1,"relative","w-full","h-screen","overflow-hidden","bg-slate-900"],[1,"absolute","inset-0","z-0","bg-cover","bg-center",2,"background-image","url('assets/bg_fog_bridge.jpg')"],[1,"absolute","inset-0","z-0","content-container","flex","flex-col","items-center","justify-center"],[1,"bg-white/95","p-8","rounded-3xl","shadow-2xl","max-w-2xl","w-full","border-4","border-pink-200","mx-4","transform","transition-all","duration-500","relative","z-20"],[1,"text-3xl","font-bold","text-pink-600","mb-6","text-center"],[1,"text-2xl","text-gray-700","mb-8","font-medium","leading-relaxed","text-center"],[1,"border-b-4","border-pink-400","font-bold","text-pink-600","px-2","inline-block","min-w-[100px]","text-center"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["class","py-4 px-6 rounded-2xl border-2 border-pink-300 font-bold text-lg transition-all hover:scale-105 active:scale-95 shadow-md text-pink-700",3,"disabled","bg-pink-500","text-white","bg-white","click",4,"ngFor","ngForOf"],["class","mt-6 text-center text-xl font-bold animate-bounce text-red-500",4,"ngIf"],[1,"absolute","bottom-0","right-4","md:right-10","z-10","w-40","md:w-60","pointer-events-none","filter","drop-shadow-2xl"],[1,"w-full","object-contain",3,"src","alt"],[1,"absolute","inset-0","z-30","touch-none","cursor-crosshair","transition-opacity","duration-1000"],["class","absolute top-1/4 left-1/2 transform -translate-x-1/2 z-40 pointer-events-none text-white text-opacity-90 font-bold text-2xl animate-pulse drop-shadow-md text-center",4,"ngIf"],["itemName","Show-Up Shield","itemImage","assets/icon_shield.png","itemDescription","It protects your peace when you show up for yourself.",3,"onContinue",4,"ngIf"],[1,"py-4","px-6","rounded-2xl","border-2","border-pink-300","font-bold","text-lg","transition-all","hover:scale-105","active:scale-95","shadow-md","text-pink-700",3,"click","disabled"],[1,"mt-6","text-center","text-xl","font-bold","animate-bounce","text-red-500"],[1,"absolute","top-1/4","left-1/2","transform","-translate-x-1/2","z-40","pointer-events-none","text-white","text-opacity-90","font-bold","text-2xl","animate-pulse","drop-shadow-md","text-center"],["itemName","Show-Up Shield","itemImage","assets/icon_shield.png","itemDescription","It protects your peace when you show up for yourself.",3,"onContinue"]],template:function(n,e){n&1&&(r(0,"div",1),x(1,"div",2),r(2,"div",3)(3,"div",4)(4,"h2",5),c(5,"Clear the Mind Fog"),a(),r(6,"p",6),c(7),r(8,"span",7),c(9),a(),c(10),a(),r(11,"div",8),g(12,j,2,8,"button",9),a(),g(13,H,2,1,"div",10),a(),r(14,"div",11),x(15,"img",12),a()(),x(16,"canvas",13,0),g(18,B,3,0,"div",14)(19,W,1,0,"app-level-completion",15),a()),n&2&&(i(3),_("scale-95",!e.fogCleared())("blur-sm",!e.fogCleared()),i(4),u(" ",e.questionParts().start," "),i(2),u(" ",e.selectedOption()||"\xA0"," "),i(),u(" ",e.questionParts().end," "),i(2),p("ngForOf",e.currentOptions()),i(),p("ngIf",e.feedbackMessage()&&!e.isLevelComplete()),i(2),p("src",e.companionImage(),k)("alt",e.gameState.companion()),i(),_("pointer-events-none",e.fogCleared())("opacity-0",e.fogCleared()),i(2),p("ngIf",!e.fogCleared()),i(),p("ngIf",e.showCompletion()))},dependencies:[T,P,R,F],styles:["[_nghost-%COMP%]{display:block;height:100vh}.content-container[_ngcontent-%COMP%]{pointer-events:none}.content-container.interactive[_ngcontent-%COMP%]{pointer-events:auto}"]})};export{q as Level2Component};
