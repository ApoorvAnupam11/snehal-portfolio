import{b as J,c as st,h as xt,i as wt,j as Y}from"./chunk-2A7FCI3D.js";import{b as X}from"./chunk-EGYWD4KQ.js";import{a as Et}from"./chunk-EMBPV7JI.js";import{a as St}from"./chunk-MOVKKYQE.js";import{A as V,B as lt,c as at,d as j,h as gt,i as Lt,j as H,l as O,m as q,p as it,v as mt,x as vt}from"./chunk-AOUDBIVJ.js";import{a as C,b as zt}from"./chunk-C6Q5SG76.js";var Z=class extends at{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return O(H,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return O(H,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return O(H,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return O(H,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return O(H,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners();for(let e in this.chars)this.chars[e].texture?.destroy();this.chars=null,t&&(this.pages.forEach(e=>e.texture.destroy(!0)),this.pages=null)}};var _t=class{constructor(t=0,e=0,i=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=i,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){let e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){let e=new Array(t.length);for(let i=0;i<t.length;i++){let s=t[i];e[i]=[s,this.get(s)]}return e}evict(t=!1){if(t||this.size>0){let e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){let e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){let t=new Array(this.size),e=this.first,i=0;for(;e!==null;)t[i++]=e.key,e=e.next;return t}setWithEvicted(t,e,i=this.resetTtl){let s=null;if(this.has(t))this.set(t,e,!0,i);else{this.max>0&&this.size===this.max&&(s=C({},this.first),this.evict(!0));let n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=n:this.last.next=n,this.last=n}return s}set(t,e,i=!1,s=this.resetTtl){let n=this.items[t];return i||n!==void 0?(n.value=e,i===!1&&s&&(n.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(n)):(this.max>0&&this.size===this.max&&this.evict(!0),n=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=n:this.last.next=n,this.last=n),this}values(t=this.keys()){let e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=this.get(t[i]);return e}};function ht(r=1e3,t=0,e=!1){if(isNaN(r)||r<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new _t(r,t,e)}function yt(r){return!!r.tagStyles&&Object.keys(r.tagStyles).length>0}function Wt(r){return r.includes("<")}function Vt(r,t){return r.clone().assign(t)}function At(r,t){let e=[],i=t.tagStyles;if(!yt(t)||!Wt(r))return e.push({text:r,style:t}),e;let s=[t],n=[],o="",a=0;for(;a<r.length;){let l=r[a];if(l==="<"){let h=r.indexOf(">",a);if(h===-1){o+=l,a++;continue}let c=r.slice(a+1,h);if(c.startsWith("/")){let f=c.slice(1).trim();if(n.length>0&&n[n.length-1]===f){o.length>0&&(e.push({text:o,style:s[s.length-1]}),o=""),s.pop(),n.pop(),a=h+1;continue}else{o+=r.slice(a,h+1),a=h+1;continue}}else{let f=c.trim();if(i[f]){o.length>0&&(e.push({text:o,style:s[s.length-1]}),o="");let k=s[s.length-1],m=Vt(k,i[f]);s.push(m),n.push(f),a=h+1;continue}else{o+=r.slice(a,h+1),a=h+1;continue}}}else o+=l,a++}return o.length>0&&e.push({text:o,style:s[s.length-1]}),e}var Xt=[10,13],Yt=new Set(Xt),Ut=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288],qt=new Set(Ut),Mt=/(\r\n|\r|\n)/,Pt=/(?:\r\n|\r|\n)/;function nt(r){return typeof r!="string"?!1:Yt.has(r.charCodeAt(0))}function P(r,t){return typeof r!="string"?!1:qt.has(r.charCodeAt(0))}function ct(r){return r==="normal"||r==="pre-line"}function dt(r){return r==="normal"}function N(r){if(typeof r!="string")return"";let t=r.length-1;for(;t>=0&&P(r[t]);)t--;return t<r.length-1?r.slice(0,t+1):r}function ft(r){let t=[],e=[];if(typeof r!="string")return t;for(let i=0;i<r.length;i++){let s=r[i],n=r[i+1];if(P(s,n)||nt(s)){e.length>0&&(t.push(e.join("")),e.length=0),s==="\r"&&n===`
`?(t.push(`\r
`),i++):t.push(s);continue}e.push(s)}return e.length>0&&t.push(e.join("")),t}function ut(r,t,e,i){let s=e(r),n=[];for(let o=0;o<s.length;o++){let a=s[o],l=a,h=1;for(;s[o+h];){let c=s[o+h];if(!i(l,c,r,o,t))a+=c,l=c,h++;else break}o+=h-1,n.push(a)}return n}var Jt=/\r\n|\r|\n/g;function It(r,t,e,i,s,n,o,a){let l=At(r,t);if(dt(t.whiteSpace))for(let z=0;z<l.length;z++){let E=l[z];l[z]={text:E.text.replace(Jt," "),style:E.style}}let c=[],f=[];for(let z of l){let E=z.text.split(Mt);for(let I=0;I<E.length;I++){let A=E[I];A===`\r
`||A==="\r"||A===`
`?(c.push(f),f=[]):A.length>0&&f.push({text:A,style:z.style})}}(f.length>0||c.length===0)&&c.push(f);let k=e?Zt(c,t,i,s,o,a):c,m=[],w=[],y=[],S=[],d=[],g=0,F=t._fontString,_=n(F);_.fontSize===0&&(_.fontSize=t.fontSize,_.ascent=t.fontSize);let u="",W=!!t.dropShadow;for(let z of k){let E=0,I=_.ascent,A=_.descent,M="";for(let G of z){let K=G.style._fontString,ot=n(K);K!==u&&(i.font=K,u=K);let et=s(G.text,G.style.letterSpacing,i);E+=et,I=Math.max(I,ot.ascent),A=Math.max(A,ot.descent),M+=G.text,!W&&G.style.dropShadow&&(W=!0)}z.length===0&&(I=_.ascent,A=_.descent),m.push(E),w.push(I),y.push(A),d.push(M);let R=t.lineHeight||I+A;S.push(R+t.leading),g=Math.max(g,E)}let b=t._stroke?.width||0,D=(e&&t.align!=="left"&&t.align!=="justify"?Math.max(g,t.wordWrapWidth):g)+b+(t.dropShadow?t.dropShadow.distance:0),T=0;for(let z=0;z<S.length;z++)T+=S[z];T=Math.max(T,S[0]+b);let v=T+(t.dropShadow?t.dropShadow.distance:0),B=t.lineHeight||_.fontSize;return{width:D,height:v,lines:d,lineWidths:m,lineHeight:B+t.leading,maxLineWidth:g,fontProperties:_,runsByLine:k,lineAscents:w,lineDescents:y,lineHeights:S,hasDropShadow:W}}function Zt(r,t,e,i,s,n){let{letterSpacing:o,whiteSpace:a,wordWrapWidth:l,breakWords:h}=t,c=ct(a),f=l+o,k={},m="",w=(S,d)=>{let g=`${S}|${d.styleKey}`,F=k[g];if(F===void 0){let _=d._fontString;_!==m&&(e.font=_,m=_),F=i(S,d.letterSpacing,e)+d.letterSpacing,k[g]=F}return F},y=[];for(let S of r){let d=Qt(S),g=y.length,F=T=>{let v=0,B=T;do{let{token:z,style:E}=d[B];v+=w(z,E),B++}while(B<d.length&&d[B].continuesFromPrevious);return v},_=T=>{let v=[],B=T;do v.push({token:d[B].token,style:d[B].style}),B++;while(B<d.length&&d[B].continuesFromPrevious);return v},u=[],W=0,b=!c,x=null,L=()=>{x&&x.text.length>0&&u.push(x),x=null},D=()=>{if(L(),u.length>0){let T=u[u.length-1];T.text=N(T.text),T.text.length===0&&u.pop()}y.push(u),u=[],W=0,b=!1};for(let T=0;T<d.length;T++){let{token:v,style:B,continuesFromPrevious:z}=d[T],E=w(v,B);if(c){let M=P(v),R=x?.text[x.text.length-1]??u[u.length-1]?.text.slice(-1)??"",G=R?P(R):!1;if(M&&G)continue}let I=!z,A=I?F(T):E;if(A>f&&I)if(W>0&&D(),h){let M=_(T);for(let R=0;R<M.length;R++){let G=M[R].token,K=M[R].style,ot=ut(G,h,n,s);for(let et of ot){let Bt=w(et,K);Bt+W>f&&D(),!x||x.style!==K?(L(),x={text:et,style:K}):x.text+=et,W+=Bt}}T+=M.length-1}else{let M=_(T);L(),y.push(M.map(R=>({text:R.token,style:R.style}))),b=!1,T+=M.length-1}else if(A+W>f&&I){if(P(v)){b=!1;continue}D(),x={text:v,style:B},W=E}else if(z&&!h)!x||x.style!==B?(L(),x={text:v,style:B}):x.text+=v,W+=E;else{let M=P(v);if(W===0&&M&&!b)continue;!x||x.style!==B?(L(),x={text:v,style:B}):x.text+=v,W+=E}}if(L(),u.length>0){let T=u[u.length-1];T.text=N(T.text),T.text.length===0&&u.pop()}(u.length>0||y.length===g)&&y.push(u)}return y}function Qt(r){let t=[],e=!1;for(let i of r){let s=ft(i.text),n=!0;for(let o of s){let a=P(o)||nt(o),l=n&&e&&!a;t.push({token:o,style:i.style,continuesFromPrevious:l}),e=!a,n=!1}}return t}var te={willReadFrequently:!0};function Ht(r,t,e,i,s){let n=e[r];return typeof n!="number"&&(n=s(r,t,i)+t,e[r]=n),n}function Ot(r,t,e,i,s,n,o){let a=e.getContext("2d",te);a.font=t._fontString;let l=0,h="",c=[],f=Object.create(null),{letterSpacing:k,whiteSpace:m}=t,w=ct(m),y=dt(m),S=!w,d=t.wordWrapWidth+k,g=ft(r);for(let _=0;_<g.length;_++){let u=g[_];if(nt(u)){if(!y){c.push(N(h)),S=!w,h="",l=0;continue}u=" "}if(w){let b=P(u),x=P(h[h.length-1]);if(b&&x)continue}let W=Ht(u,k,f,a,i);if(W>d)if(h!==""&&(c.push(N(h)),h="",l=0),s(u,t.breakWords)){let b=ut(u,t.breakWords,o,n);for(let x of b){let L=Ht(x,k,f,a,i);L+l>d&&(c.push(N(h)),S=!1,h="",l=0),h+=x,l+=L}}else h.length>0&&(c.push(N(h)),h="",l=0),c.push(N(u)),S=!1,h="",l=0;else W+l>d&&(S=!1,c.push(N(h)),h="",l=0),(h.length>0||!P(u)||S)&&(h+=u,l+=W)}let F=N(h);return F.length>0&&c.push(F),c.join(`
`)}var Rt={willReadFrequently:!0},$=class p{static get experimentalLetterSpacingSupported(){let t=p._experimentalLetterSpacingSupported;if(t===void 0){let e=lt.get().getCanvasRenderingContext2D().prototype;t=p._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,i,s,n,o,a,l,h,c){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=n,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=h,c&&(this.runsByLine=c.runsByLine,this.lineAscents=c.lineAscents,this.lineDescents=c.lineDescents,this.lineHeights=c.lineHeights,this.hasDropShadow=c.hasDropShadow)}static measureText(t=" ",e,i=p._canvas,s=e.wordWrap){let n=`${t}-${e.styleKey}-wordWrap-${s}`;if(p._measurementCache.has(n))return p._measurementCache.get(n);if(yt(e)&&Wt(t)){let u=It(t,e,s,p._context,p._measureText,p.measureFont,p.canBreakChars,p.wordWrapSplit),W=new p(t,e,u.width,u.height,u.lines,u.lineWidths,u.lineHeight,u.maxLineWidth,u.fontProperties,{runsByLine:u.runsByLine,lineAscents:u.lineAscents,lineDescents:u.lineDescents,lineHeights:u.lineHeights,hasDropShadow:u.hasDropShadow});return p._measurementCache.set(n,W),W}let a=e._fontString,l=p.measureFont(a);l.fontSize===0&&(l.fontSize=e.fontSize,l.ascent=e.fontSize,l.descent=0);let h=p._context;h.font=a;let f=(s?p._wordWrap(t,e,i):t).split(Pt),k=new Array(f.length),m=0;for(let u=0;u<f.length;u++){let W=p._measureText(f[u],e.letterSpacing,h);k[u]=W,m=Math.max(m,W)}let w=e._stroke?.width??0,y=e.lineHeight||l.fontSize,S=p._getAlignWidth(m,e,s),d=p._adjustWidthForStyle(S,e),g=Math.max(y,l.fontSize+w)+(f.length-1)*(y+e.leading),F=p._adjustHeightForStyle(g,e),_=new p(t,e,d,F,f,k,y+e.leading,m,l);return p._measurementCache.set(n,_),_}static _adjustWidthForStyle(t,e){let i=e._stroke?.width||0,s=t+i;return e.dropShadow&&(s+=e.dropShadow.distance),s}static _adjustHeightForStyle(t,e){let i=t;return e.dropShadow&&(i+=e.dropShadow.distance),i}static _getAlignWidth(t,e,i){return i&&e.align!=="left"&&e.align!=="justify"?Math.max(t,e.wordWrapWidth):t}static _measureText(t,e,i){let s=!1;p.experimentalLetterSpacingSupported&&(p.experimentalLetterSpacing?(i.letterSpacing=`${e}px`,i.textLetterSpacing=`${e}px`,s=!0):(i.letterSpacing="0px",i.textLetterSpacing="0px"));let n=i.measureText(t),o=n.width,a=-(n.actualBoundingBoxLeft??0),h=(n.actualBoundingBoxRight??0)-a;if(o>0)if(s)o-=e,h-=e;else{let c=(p.graphemeSegmenter(t).length-1)*e;o+=c,h+=c}return Math.max(o,h)}static _wordWrap(t,e,i=p._canvas){return Ot(t,e,i,p._measureText,p.canBreakWords,p.canBreakChars,p.wordWrapSplit)}static isBreakingSpace(t,e){return P(t,e)}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,n){return!0}static wordWrapSplit(t){return p.graphemeSegmenter(t)}static measureFont(t){if(p._fonts[t])return p._fonts[t];let e=p._context;e.font=t;let i=e.measureText(p.METRICS_STRING+p.BASELINE_SYMBOL),s=i.actualBoundingBoxAscent??0,n=i.actualBoundingBoxDescent??0,o={ascent:s,descent:n,fontSize:s+n};return p._fonts[t]=o,o}static clearMetrics(t=""){t?delete p._fonts[t]:p._fonts={}}static get _canvas(){if(!p.__canvas){let t;try{let e=new OffscreenCanvas(0,0);if(e.getContext("2d",Rt)?.measureText)return p.__canvas=e,e;t=lt.get().createCanvas()}catch{t=lt.get().createCanvas()}t.width=t.height=10,p.__canvas=t}return p.__canvas}static get _context(){return p.__context||(p.__context=p._canvas.getContext("2d",Rt)),p.__context}};$.METRICS_STRING="|\xC9q\xC5";$.BASELINE_SYMBOL="M";$.BASELINE_MULTIPLIER=1.4;$.HEIGHT_MULTIPLIER=2;$.graphemeSegmenter=(()=>{if(typeof Intl?.Segmenter=="function"){let r=new Intl.Segmenter;return t=>{let e=r.segment(t),i=[],s=0;for(let n of e)i[s++]=n.segment;return i}}return r=>[...r]})();$.experimentalLetterSpacing=!1;$._fonts={};$._measurementCache=ht(1e3);var Q=$;var ee=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function rt(r){let t=typeof r.fontSize=="number"?`${r.fontSize}px`:r.fontSize,e=r.fontFamily;Array.isArray(r.fontFamily)||(e=r.fontFamily.split(","));for(let i=e.length-1;i>=0;i--){let s=e[i].trim();!/([\"\'])[^\'\"]+\1/.test(s)&&!ee.includes(s)&&(s=`"${s}"`),e[i]=s}return`${r.fontStyle} ${r.fontVariant} ${r.fontWeight} ${t} ${e.join(",")}`}var kt=class U extends at{constructor(t={}){super(),this.uid=Lt("textStyle"),this._tick=0,this._cachedFontString=null,ie(t),t instanceof U&&(t=t._toObject());let s=C(C({},U.defaultTextStyle),t);for(let n in s){let o=n;this[o]=s[n]}this._tagStyles=t.tagStyles??void 0,this.update(),this._tick=0}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.update())}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.update())}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(t!==null&&typeof t=="object"?this._dropShadow=this._createProxy(C(C({},U.defaultDropShadow),t)):this._dropShadow=t?this._createProxy(C({},U.defaultDropShadow)):null,this.update())}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!==t&&(this._fontFamily=t,this.update())}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update())}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t.toLowerCase(),this.update())}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.update())}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.update())}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.update())}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.update())}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.update())}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.update())}get filters(){return this._filters}set filters(t){this._filters!==t&&(this._filters=Object.freeze(t),this.update())}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.update())}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.update())}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.update())}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.update())}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.update())}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy(C(C({},Y.defaultFillStyle),t),()=>{this._fill=xt(C({},this._originalFill),Y.defaultFillStyle)})),this._fill=xt(t===0?"black":t,Y.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy(C(C({},Y.defaultStrokeStyle),t),()=>{this._stroke=wt(C({},this._originalStroke),Y.defaultStrokeStyle)})),this._stroke=wt(t,Y.defaultStrokeStyle),this.update())}get tagStyles(){return this._tagStyles}set tagStyles(t){this._tagStyles!==t&&(this._tagStyles=t??void 0,this.update())}update(){this._tick++,this._cachedFontString=null,this.emit("update",this)}reset(){let t=U.defaultTextStyle;for(let e in t)this[e]=t[e]}assign(t){for(let e in t){let i=e;this[i]=t[e]}return this}get styleKey(){return`${this.uid}-${this._tick}`}get _fontString(){return this._cachedFontString===null&&(this._cachedFontString=rt(this)),this._cachedFontString}_toObject(){return{align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?C({},this._dropShadow):null,fill:this._fill?C({},this._fill):void 0,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke?C({},this._stroke):void 0,textBaseline:this.textBaseline,trim:this.trim,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0,tagStyles:this._tagStyles?C({},this._tagStyles):void 0}}clone(){return new U(this._toObject())}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){if(this.removeAllListeners(),typeof t=="boolean"?t:t?.texture){let i=typeof t=="boolean"?t:t?.textureSource;this._fill?.texture&&this._fill.texture.destroy(i),this._originalFill?.texture&&this._originalFill.texture.destroy(i),this._stroke?.texture&&this._stroke.texture.destroy(i),this._originalStroke?.texture&&this._originalStroke.texture.destroy(i)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(i,s,n)=>(i[s]===n||(i[s]=n,e?.(s,n),this.update()),!0)})}_isFillStyle(t){return(t??null)!==null&&!(j.isColorLike(t)||t instanceof J||t instanceof st)}};kt.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};kt.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};var tt=kt;function ie(r){let t=r;if(typeof t.dropShadow=="boolean"&&t.dropShadow){let e=tt.defaultDropShadow;r.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){O(H,"strokeThickness is now a part of stroke");let e=t.stroke,i={};if(j.isColorLike(e))i.color=e;else if(e instanceof J||e instanceof st)i.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))i=e;else throw new Error("Invalid stroke value.");r.stroke=zt(C({},i),{width:t.strokeThickness})}if(Array.isArray(t.fillGradientStops)){if(O(H,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&q("The number of fill colors must match the number of fill gradient stops.");let e=new J({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),i=t.fillGradientStops.slice(),s=t.fill.map(n=>j.shared.setValue(n).toNumber());i.forEach((n,o)=>{e.addColorStop(n,s[o])}),r.fill={fill:e}}}var Nt=1e5;function Ft(r,t,e,i=0,s=0,n=0){if(r.texture===V.WHITE&&!r.fill)return j.shared.setValue(r.color).setAlpha(r.alpha??1).toHexa();if(r.fill){if(r.fill instanceof st){let o=r.fill,a=t.createPattern(o.texture.source.resource,"repeat"),l=o.transform.copyTo(gt.shared);return l.scale(o.texture.source.pixelWidth,o.texture.source.pixelHeight),a.setTransform(l),a}else if(r.fill instanceof J){let o=r.fill,a=o.type==="linear",l=o.textureSpace==="local",h=1,c=1;l&&e&&(h=e.width+i,c=e.height+i);let f,k=!1;if(a){let{start:m,end:w}=o;f=t.createLinearGradient(m.x*h+s,m.y*c+n,w.x*h+s,w.y*c+n),k=Math.abs(w.x-m.x)<Math.abs((w.y-m.y)*.1)}else{let{center:m,innerRadius:w,outerCenter:y,outerRadius:S}=o;f=t.createRadialGradient(m.x*h+s,m.y*c+n,w*h,y.x*h+s,y.y*c+n,S*h)}if(k&&l&&e){let m=e.lineHeight/c;for(let w=0;w<e.lines.length;w++){let y=(w*e.lineHeight+i/2)/c;o.colorStops.forEach(S=>{let d=y+S.offset*m;d=Math.max(0,Math.min(1,d)),f.addColorStop(Math.floor(d*Nt)/Nt,j.shared.setValue(S.color).toHex())})}}else o.colorStops.forEach(m=>{f.addColorStop(m.offset,j.shared.setValue(m.color).toHex())});return f}}else{let o=t.createPattern(r.texture.source.resource,"repeat"),a=r.matrix.copyTo(gt.shared);return a.scale(r.texture.source.pixelWidth,r.texture.source.pixelHeight),o.setTransform(a),o}return q("FillStyle not recognised",r),"red"}var jt=class Gt extends Z{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;let e=C(C({},Gt.defaultOptions),t);this._textureSize=e.textureSize,this._mipmap=e.mipmap;let i=e.style.clone();e.overrideFill&&(i._fill.color=16777215,i._fill.alpha=1,i._fill.texture=V.WHITE,i._fill.fill=null),this.applyFillAsTint=e.overrideFill;let s=i.fontSize;i.fontSize=this.baseMeasurementFontSize;let n=rt(i);e.overrideSize?i._stroke&&(i._stroke.width*=this.baseRenderedFontSize/s):i.fontSize=this.baseRenderedFontSize=s,this._style=i,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof mt?e.textureStyle:new mt(e.textureStyle)),this.fontMetrics=Q.measureFont(n),this.lineHeight=i.lineHeight||this.fontMetrics.fontSize||i.fontSize}ensureCharacters(t){let e=Q.graphemeSegmenter(t).filter(S=>!this._currentChars.includes(S)).filter((S,d,g)=>g.indexOf(S)===d);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let i;this._currentPageIndex===-1?i=this._nextPage():i=this.pages[this._currentPageIndex];let{canvas:s,context:n}=i.canvasAndContext,o=i.texture.source,a=this._style,l=this._currentX,h=this._currentY,c=this._currentMaxCharHeight,f=this.baseRenderedFontSize/this.baseMeasurementFontSize,k=this._padding*f,m=!1,w=s.width/this.resolution,y=s.height/this.resolution;for(let S=0;S<e.length;S++){let d=e[S],g=Q.measureText(d,a,s,!1);g.lineHeight=g.height;let F=g.width*f,_=Math.ceil((a.fontStyle==="italic"?2:1)*F),u=g.height*f,W=_+k*2,b=u+k*2;if(m=!1,d!==`
`&&d!=="\r"&&d!=="	"&&d!==" "&&(m=!0,c=Math.ceil(Math.max(b,c))),l+W>w&&(h+=c,c=b,l=0,h+c>y)){o.update();let L=this._nextPage();s=L.canvasAndContext.canvas,n=L.canvasAndContext.context,o=L.texture.source,l=0,h=0,c=0}let x=F/f-(a.dropShadow?.distance??0)-(a._stroke?.width??0);if(this.chars[d]={id:d.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:x,kerning:{}},m){this._drawGlyph(n,g,l+k,h+k,f,a);let L=o.width*f,D=o.height*f,T=new it(l/L*o.width,h/D*o.height,W/L*o.width,b/D*o.height);this.chars[d].texture=new V({source:o,frame:T}),l+=Math.ceil(W)}}o.update(),this._currentX=l,this._currentY=h,this._currentMaxCharHeight=c,this._skipKerning&&this._applyKerning(e,n)}get pageTextures(){return O(H,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){let i=this._measureCache;for(let s=0;s<t.length;s++){let n=t[s];for(let o=0;o<this._currentChars.length;o++){let a=this._currentChars[o],l=i[n];l||(l=i[n]=e.measureText(n).width);let h=i[a];h||(h=i[a]=e.measureText(a).width);let c=e.measureText(n+a).width,f=c-(l+h);f&&(this.chars[n].kerning[a]=f),c=e.measureText(n+a).width,f=c-(l+h),f&&(this.chars[a].kerning[n]=f)}}}_nextPage(){this._currentPageIndex++;let t=this.resolution,e=St.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);let i=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),s=new V({source:new Et({resource:e.canvas,resolution:i,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(s.source.style=this._textureStyle);let n={canvasAndContext:e,texture:s};return this.pages[this._currentPageIndex]=n,n}_setupContext(t,e,i){e.fontSize=this.baseRenderedFontSize,t.scale(i,i),t.font=rt(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;let s=e._stroke,n=s?.width??0;if(s&&(t.lineWidth=n,t.lineJoin=s.join,t.miterLimit=s.miterLimit,t.strokeStyle=Ft(s,t)),e._fill&&(t.fillStyle=Ft(e._fill,t)),e.dropShadow){let o=e.dropShadow,a=j.shared.setValue(o.color).toArray(),l=o.blur*i,h=o.distance*i;t.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(o.angle)*h,t.shadowOffsetY=Math.sin(o.angle)*h}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,i,s,n,o){let a=e.text,l=e.fontProperties,c=(o._stroke?.width??0)*n,f=i+c/2,k=s-c/2,m=l.descent*n,w=e.lineHeight*n,y=!1;o.stroke&&c&&(y=!0,t.strokeText(a,f,k+w-m));let{shadowBlur:S,shadowOffsetX:d,shadowOffsetY:g}=t;o._fill&&(y&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,f,k+w-m)),y&&(t.shadowBlur=S,t.shadowOffsetX=d,t.shadowOffsetY=g)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){let{canvasAndContext:e,texture:i}=this.pages[t];St.returnCanvasAndContext(e),i.destroy(!0)}this.pages=null}};jt.defaultOptions={textureSize:512,style:new tt,mipmap:!0};var Tt=jt;function $t(r,t,e,i){let s={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};s.offsetY=e.baseLineOffset;let n=s.lines[0],o=null,a=!0,l={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},h=e.baseMeasurementFontSize/t.fontSize,c=t.letterSpacing*h,f=t.wordWrapWidth*h,k=t.lineHeight?t.lineHeight*h:e.lineHeight,m=t.wordWrap&&t.breakWords,w=d=>{let g=n.width;for(let F=0;F<l.index;F++){let _=d.positions[F];n.chars.push(d.chars[F]),n.charPositions.push(_+g)}n.width+=d.width,a=!1,l.width=0,l.index=0,l.chars.length=0},y=()=>{let d=n.chars.length-1;if(i){let g=n.chars[d];for(;g===" ";)n.width-=e.chars[g].xAdvance,g=n.chars[--d]}s.width=Math.max(s.width,n.width),n={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,s.lines.push(n),s.height+=k},S=d=>d-c>f;for(let d=0;d<r.length+1;d++){let g,F=d===r.length;F||(g=r[d]);let _=e.chars[g]||e.chars[" "];if(/(?:\s)/.test(g)||g==="\r"||g===`
`||F){if(!a&&t.wordWrap&&S(n.width+l.width)?(y(),w(l),F||n.charPositions.push(0)):(l.start=n.width,w(l),F||n.charPositions.push(0)),g==="\r"||g===`
`)y();else if(!F){let x=_.xAdvance+(_.kerning[o]||0)+c;n.width+=x,n.spaceWidth=x,n.spacesIndex.push(n.charPositions.length),n.chars.push(g)}}else{let b=_.kerning[o]||0,x=_.xAdvance+b+c;m&&S(n.width+l.width+x)&&(w(l),y()),l.positions[l.index++]=l.width+b,l.chars.push(g),l.width+=x}o=g}return y(),t.align==="center"?se(s):t.align==="right"?ne(s):t.align==="justify"&&re(s),s}function se(r){for(let t=0;t<r.lines.length;t++){let e=r.lines[t],i=r.width/2-e.width/2;for(let s=0;s<e.charPositions.length;s++)e.charPositions[s]+=i}}function ne(r){for(let t=0;t<r.lines.length;t++){let e=r.lines[t],i=r.width-e.width;for(let s=0;s<e.charPositions.length;s++)e.charPositions[s]+=i}}function re(r){let t=r.width;for(let e=0;e<r.lines.length;e++){let i=r.lines[e],s=0,n=i.spacesIndex[s++],o=0,a=i.spacesIndex.length,h=(t-i.width)/a;for(let c=0;c<i.charPositions.length;c++)c===n&&(n=i.spacesIndex[s++],o+=h),i.charPositions[c]+=o}}function Dt(r){if(r==="")return[];typeof r=="string"&&(r=[r]);let t=[];for(let e=0,i=r.length;e<i;e++){let s=r[e];if(Array.isArray(s)){if(s.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);if(s[0].length===0||s[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");let n=s[0].charCodeAt(0),o=s[1].charCodeAt(0);if(o<n)throw new Error("[BitmapFont]: Invalid character range.");for(let a=n,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Array.from(s))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}var pt=0,Ct=class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=ht(1e3)}getFont(t,e){let i=`${e.fontFamily}-bitmap`,s=!0;if(e._fill.fill&&!e._stroke?(i+=e._fill.fill.styleKey,s=!1):(e._stroke||e.dropShadow)&&(i=`${e.styleKey}-bitmap`,s=!1),!X.has(i)){let o=Object.create(e);o._lineHeight=0;let a=new Tt(C({style:o,overrideFill:s,overrideSize:!0},this.defaultOptions));pt++,pt>50&&q("BitmapText",`You have dynamically created ${pt} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),a.once("destroy",()=>{pt--,X.remove(i)}),X.set(i,a)}let n=X.get(i);return n.ensureCharacters?.(t),n}getLayout(t,e,i=!0){let s=this.getFont(t,e),n=`${t}-${e.styleKey}-${i}`;if(this.measureCache.has(n))return this.measureCache.get(n);let o=Q.graphemeSegmenter(t),a=$t(o,e,s,i);return this.measureCache.set(n,a),a}measureText(t,e,i=!0){return this.getLayout(t,e,i)}install(...t){let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:t[2]?.chars,resolution:t[2]?.resolution,padding:t[2]?.padding,skipKerning:t[2]?.skipKerning},O(H,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));let i=e?.name;if(!i)throw new Error("[BitmapFontManager] Property `name` is required.");e=C(C({},this.defaultOptions),e);let s=e.style,n=s instanceof tt?s:new tt(s),o=e.dynamicFill??this._canUseTintForStyle(n),a=new Tt({style:n,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),l=Dt(e.chars);return a.ensureCharacters(l.join("")),X.set(`${i}-bitmap`,a),a.once("destroy",()=>X.remove(`${i}-bitmap`)),a}uninstall(t){let e=`${t}-bitmap`,i=X.get(e);i&&i.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}},bt=new Ct;var Kt=class extends Z{constructor(t,e){super();let{textures:i,data:s}=t;Object.keys(s.pages).forEach(n=>{let o=s.pages[parseInt(n,10)],a=i[o.id];this.pages.push({texture:a})}),Object.keys(s.chars).forEach(n=>{let o=s.chars[n],{frame:a,source:l,rotate:h}=i[o.page],c=vt.transformRectCoords(o,a,h,new it),f=new V({frame:c,orig:new it(0,0,o.width,o.height),source:l,rotate:h});this.chars[n]={id:n.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:f}}),this.baseRenderedFontSize=s.fontSize,this.baseMeasurementFontSize=s.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:s.fontSize},this.baseLineOffset=s.baseLineOffset,this.lineHeight=s.lineHeight,this.fontFamily=s.fontFamily,this.distanceField=s.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){let{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){bt.install(t)}static uninstall(t){bt.uninstall(t)}};export{Q as a,rt as b,tt as c,Ft as d,Kt as e};
