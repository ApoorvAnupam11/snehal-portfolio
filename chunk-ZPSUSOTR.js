import{a as pe,b as ue,c as me,d as fe,e as ge,f as xe,g as Ce,j as tt}from"./chunk-2A7FCI3D.js";import{c as re,d as oe,f as ne,g as se,i as ae,j as ie,k as ce,l as le,m as he,o as de}from"./chunk-TPSZSGEE.js";import{o as Z}from"./chunk-DL7DH7M3.js";import{h as gt,s as Zt,u as te,v as xt}from"./chunk-FEUSPEM3.js";import{A as Dt,B as M,I as ee,a as m,b as A,d as V,h as k,j as H,l as U,m as Kt,o as Gt,r as Q,s as Qt,x as w}from"./chunk-AOUDBIVJ.js";import{a as $t,c as Jt}from"./chunk-C6Q5SG76.js";var et;function ye(s){let t=M.get().createCanvas(6,1),e=t.getContext("2d");return e.fillStyle=s,e.fillRect(0,0,6,1),t}function Ct(){if(et!==void 0)return et;try{let s=ye("#ff00ff"),t=ye("#ffff00"),o=M.get().createCanvas(6,1).getContext("2d");o.globalCompositeOperation="multiply",o.drawImage(s,0,0),o.drawImage(t,2,0);let r=o.getImageData(2,0,1,1);if(!r)et=!1;else{let n=r.data;et=n[0]===255&&n[1]===0&&n[2]===0}}catch{et=!1}return et}var d={canvas:null,convertTintToImage:!1,cacheStepsPerColorChannel:8,canUseMultiply:Ct(),tintMethod:null,_canvasSourceCache:new WeakMap,_unpremultipliedCache:new WeakMap,getCanvasSource:s=>{let t=s.source,e=t?.resource;if(!e)return null;let o=t.alphaMode==="premultiplied-alpha",r=t.resourceWidth??t.pixelWidth,n=t.resourceHeight??t.pixelHeight,a=r!==t.pixelWidth||n!==t.pixelHeight;if(o){if((e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)&&!a)return e;let i=d._unpremultipliedCache.get(t);if(i?.resourceId===t._resourceId)return i.canvas}if(e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof ArrayBuffer){let i=d._canvasSourceCache.get(t);if(i?.resourceId===t._resourceId)return i.canvas;let c=M.get().createCanvas(t.pixelWidth,t.pixelHeight),h=c.getContext("2d"),l=h.createImageData(t.pixelWidth,t.pixelHeight),u=l.data,x=e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(t.format==="bgra8unorm")for(let C=0;C<u.length&&C+3<x.length;C+=4)u[C]=x[C+2],u[C+1]=x[C+1],u[C+2]=x[C],u[C+3]=x[C+3];else u.set(x.subarray(0,u.length));return h.putImageData(l,0,0),d._canvasSourceCache.set(t,{canvas:c,resourceId:t._resourceId}),c}if(o){let i=M.get().createCanvas(t.pixelWidth,t.pixelHeight),c=i.getContext("2d",{willReadFrequently:!0});i.width=t.pixelWidth,i.height=t.pixelHeight,c.drawImage(e,0,0);let h=c.getImageData(0,0,i.width,i.height),l=h.data;for(let u=0;u<l.length;u+=4){let x=l[u+3];if(x>0){let C=255/x;l[u]=Math.min(255,l[u]*C+.5),l[u+1]=Math.min(255,l[u+1]*C+.5),l[u+2]=Math.min(255,l[u+2]*C+.5)}}return c.putImageData(h,0,0),d._unpremultipliedCache.set(t,{canvas:i,resourceId:t._resourceId}),i}if(a){let i=d._canvasSourceCache.get(t);if(i?.resourceId===t._resourceId)return i.canvas;let c=M.get().createCanvas(t.pixelWidth,t.pixelHeight),h=c.getContext("2d");return c.width=t.pixelWidth,c.height=t.pixelHeight,h.drawImage(e,0,0),d._canvasSourceCache.set(t,{canvas:c,resourceId:t._resourceId}),c}return e},getTintedCanvas:(s,t)=>{let e=s.texture,o=V.shared.setValue(t).toHex(),r=e.tintCache||(e.tintCache={}),n=r[o],a=e.source._resourceId;if(n?.tintId===a)return n;let i=n&&"getContext"in n?n:M.get().createCanvas();if(d.tintMethod(e,t,i),i.tintId=a,d.convertTintToImage&&i.toDataURL!==void 0){let c=M.get().createImage();c.src=i.toDataURL(),c.tintId=a,r[o]=c}else r[o]=i;return r[o]},getTintedPattern:(s,t)=>{let e=V.shared.setValue(t).toHex(),o=s.patternCache||(s.patternCache={}),r=s.source._resourceId,n=o[e];return n?.tintId===r||(d.canvas||(d.canvas=M.get().createCanvas()),d.tintMethod(s,t,d.canvas),n=d.canvas.getContext("2d").createPattern(d.canvas,"repeat"),n.tintId=r,o[e]=n),n},applyPatternTransform:(s,t,e=!0)=>{if(!t)return;let o=s;if(!o.setTransform)return;let r=globalThis.DOMMatrix;if(!r)return;let n=new r([t.a,t.b,t.c,t.d,t.tx,t.ty]);o.setTransform(e?n.inverse():n)},tintWithMultiply:(s,t,e)=>{let o=e.getContext("2d"),r=s.frame.clone(),n=s.source._resolution??s.source.resolution??1,a=s.rotate;r.x*=n,r.y*=n,r.width*=n,r.height*=n;let i=w.isVertical(a),c=i?r.height:r.width,h=i?r.width:r.height;e.width=Math.ceil(c),e.height=Math.ceil(h),o.save(),o.fillStyle=V.shared.setValue(t).toHex(),o.fillRect(0,0,c,h),o.globalCompositeOperation="multiply";let l=d.getCanvasSource(s);if(!l){o.restore();return}a&&d._applyInverseRotation(o,a,r.width,r.height),o.drawImage(l,r.x,r.y,r.width,r.height,0,0,r.width,r.height),o.globalCompositeOperation="destination-atop",o.drawImage(l,r.x,r.y,r.width,r.height,0,0,r.width,r.height),o.restore()},tintWithOverlay:(s,t,e)=>{let o=e.getContext("2d"),r=s.frame.clone(),n=s.source._resolution??s.source.resolution??1,a=s.rotate;r.x*=n,r.y*=n,r.width*=n,r.height*=n;let i=w.isVertical(a),c=i?r.height:r.width,h=i?r.width:r.height;e.width=Math.ceil(c),e.height=Math.ceil(h),o.save(),o.globalCompositeOperation="copy",o.fillStyle=V.shared.setValue(t).toHex(),o.fillRect(0,0,c,h),o.globalCompositeOperation="destination-atop";let l=d.getCanvasSource(s);if(!l){o.restore();return}a&&d._applyInverseRotation(o,a,r.width,r.height),o.drawImage(l,r.x,r.y,r.width,r.height,0,0,r.width,r.height),o.restore()},tintWithPerPixel:(s,t,e)=>{let o=e.getContext("2d"),r=s.frame.clone(),n=s.source._resolution??s.source.resolution??1,a=s.rotate;r.x*=n,r.y*=n,r.width*=n,r.height*=n;let i=w.isVertical(a),c=i?r.height:r.width,h=i?r.width:r.height;e.width=Math.ceil(c),e.height=Math.ceil(h),o.save(),o.globalCompositeOperation="copy";let l=d.getCanvasSource(s);if(!l){o.restore();return}a&&d._applyInverseRotation(o,a,r.width,r.height),o.drawImage(l,r.x,r.y,r.width,r.height,0,0,r.width,r.height),o.restore();let u=t>>16&255,x=t>>8&255,C=t&255,G=o.getImageData(0,0,c,h),b=G.data;for(let _=0;_<b.length;_+=4)b[_]=b[_]*u/255,b[_+1]=b[_+1]*x/255,b[_+2]=b[_+2]*C/255;o.putImageData(G,0,0)},_applyInverseRotation:(s,t,e,o)=>{let r=w.inv(t),n=w.uX(r),a=w.uY(r),i=w.vX(r),c=w.vY(r),h=-Math.min(0,n*e,i*o,n*e+i*o),l=-Math.min(0,a*e,c*o,a*e+c*o);s.transform(n,a,i,c,h,l)}};d.tintMethod=d.canUseMultiply?d.tintWithMultiply:d.tintWithPerPixel;var Ge="#808080",yt=new k,De=new k,Be=new k,Bt=new k;function Ae(s,t,e){s.beginPath();for(let o=0;o<e.length;o+=3){let r=e[o]*2,n=e[o+1]*2,a=e[o+2]*2;s.moveTo(t[r],t[r+1]),s.lineTo(t[n],t[n+1]),s.lineTo(t[a],t[a+1]),s.closePath()}s.fill()}function He(s){return`#${(s&16777215).toString(16).padStart(6,"0")}`}function Ue(s,t,e,o,r,n){n=Math.max(0,Math.min(n,Math.min(o,r)/2)),s.moveTo(t+n,e),s.lineTo(t+o-n,e),s.quadraticCurveTo(t+o,e,t+o,e+n),s.lineTo(t+o,e+r-n),s.quadraticCurveTo(t+o,e+r,t+o-n,e+r),s.lineTo(t+n,e+r),s.quadraticCurveTo(t,e+r,t,e+r-n),s.lineTo(t,e+n),s.quadraticCurveTo(t,e,t+n,e)}function _t(s,t){switch(t.type){case"rectangle":{let e=t;s.rect(e.x,e.y,e.width,e.height);break}case"roundedRectangle":{let e=t;Ue(s,e.x,e.y,e.width,e.height,e.radius);break}case"circle":{let e=t;s.arc(e.x,e.y,e.radius,0,Math.PI*2);break}case"ellipse":{let e=t;s.ellipse?s.ellipse(e.x,e.y,e.halfWidth,e.halfHeight,0,0,Math.PI*2):(s.save(),s.translate(e.x,e.y),s.scale(e.halfWidth,e.halfHeight),s.arc(0,0,1,0,Math.PI*2),s.restore());break}case"triangle":{let e=t;s.moveTo(e.x,e.y),s.lineTo(e.x2,e.y2),s.lineTo(e.x3,e.y3),s.closePath();break}default:{let e=t,o=e.points;if(!o?.length)break;s.moveTo(o[0],o[1]);for(let r=2;r<o.length;r+=2)s.lineTo(o[r],o[r+1]);e.closePath&&s.closePath();break}}}function We(s,t){if(!t?.length)return!1;for(let e=0;e<t.length;e++){let o=t[e];if(!o?.shape)continue;let r=o.transform,n=r&&!r.isIdentity();n&&(s.save(),s.transform(r.a,r.b,r.c,r.d,r.tx,r.ty)),_t(s,o.shape),n&&s.restore()}return!0}function Ee(s,t,e,o){let r=s.fill;if(r instanceof ue){r.buildGradient();let a=r.texture;if(a){let i=d.getTintedPattern(a,t),c=e?Bt.copyFrom(e).scale(a.source.pixelWidth,a.source.pixelHeight):Bt.copyFrom(r.transform);return o&&!s.textureSpace&&c.append(o),d.applyPatternTransform(i,c),i}}if(r instanceof me){let a=d.getTintedPattern(r.texture,t);return d.applyPatternTransform(a,r.transform),a}let n=s.texture;if(n&&n!==Dt.WHITE){if(!n.source.resource)return Ge;let a=d.getTintedPattern(n,t),i=e?Bt.copyFrom(e).scale(n.source.pixelWidth,n.source.pixelHeight):s.matrix;return d.applyPatternTransform(a,i),a}return He(t)}var nt=class{constructor(){this.shader=null}contextChange(t){}execute(t,e){let o=t.renderer,r=o.canvasContext,n=r.activeContext,a=e.groupTransform,i=o.globalUniforms.globalUniformData?.worldColor??4294967295,c=e.groupColorAlpha,h=(i>>>24&255)/255,l=(c>>>24&255)/255,u=o.filter?.alphaMultiplier??1,x=h*l*u;if(x<=0)return;let C=i&16777215,G=c&16777215,b=gt(Q(G,C)),_=o._roundPixels|e._roundPixels;n.save(),r.setContextTransform(a,_===1),r.setBlendMode(e.groupBlendMode);let W=e.context.instructions;for(let T=0;T<W.length;T++){let E=W[T];if(E.action==="texture"){let g=E.data,y=g.image,v=y?d.getCanvasSource(y):null;if(!v)continue;let L=g.alpha*x;if(L<=0)continue;let $=Q(g.style,b);n.globalAlpha=L;let R=v;$!==16777215&&(R=d.getTintedCanvas({texture:y},$));let q=y.frame,S=y.source._resolution??y.source.resolution??1,D=q.x*S,B=q.y*S,ot=q.width*S,j=q.height*S;R!==v&&(D=0,B=0);let O=g.transform,P=O&&!O.isIdentity(),p=y.rotate;P||p?(yt.copyFrom(a),P&&yt.append(O),p&&w.matrixAppendRotationInv(yt,p,g.dx,g.dy,g.dw,g.dh),r.setContextTransform(yt,_===1)):r.setContextTransform(a,_===1),n.drawImage(R,D,B,R===v?ot:R.width,R===v?j:R.height,p?0:g.dx,p?0:g.dy,g.dw,g.dh),(P||p)&&r.setContextTransform(a,_===1);continue}let N=E.data,ut=N?.path?.shapePath;if(!ut?.shapePrimitives?.length)continue;let I=N.style,Y=Q(I.color,b),F=I.alpha*x;if(F<=0)continue;let rt=E.action==="stroke";if(n.globalAlpha=F,rt){let g=I;n.lineWidth=g.width,n.lineCap=g.cap,n.lineJoin=g.join,n.miterLimit=g.miterLimit}let X=ut.shapePrimitives;if(!rt&&N.hole?.shapePath?.shapePrimitives?.length){let g=X[X.length-1];g.holes=N.hole.shapePath.shapePrimitives}for(let g=0;g<X.length;g++){let y=X[g];if(!y?.shape)continue;let v=y.transform,L=v&&!v.isIdentity(),$=I.texture&&I.texture!==Dt.WHITE,R=I.textureSpace==="global"?v:null,q=$?ge(De,I,y.shape,R):null,S=L?Be.copyFrom(a).append(v):a,D=Ee(I,Y,q,S);if(L&&(n.save(),n.transform(v.a,v.b,v.c,v.d,v.tx,v.ty)),rt){let B=I;if(B.alignment!==.5&&!B.pixelLine){let j=[],O=[],P=[];if(xe[y.shape.type]?.build(y.shape,j)){let Tt=y.shape.closePath??!0;pe(j,B,!1,Tt,O,P),n.fillStyle=D,Ae(n,O,P)}else n.strokeStyle=D,n.beginPath(),_t(n,y.shape),n.stroke()}else n.strokeStyle=D,n.beginPath(),_t(n,y.shape),n.stroke()}else n.fillStyle=D,n.beginPath(),_t(n,y.shape),We(n,y.holes)?n.fill("evenodd"):n.fill();L&&n.restore()}}n.restore()}destroy(){this.shader=null}};nt.extension={type:[m.CanvasPipesAdaptor],name:"graphics"};var At=class z{static _getPatternRepeat(t,e){let o=t&&t!=="clamp-to-edge",r=e&&e!=="clamp-to-edge";return o&&r?"repeat":o?"repeat-x":r?"repeat-y":"no-repeat"}start(t,e,o){}execute(t,e){let o=e.elements;if(!o||!o.length)return;let r=t.renderer,n=r.canvasContext,a=n.activeContext;for(let i=0;i<o.length;i++){let c=o[i];if(!c.packAsQuad)continue;let h=c,l=h.texture,u=l?d.getCanvasSource(l):null;if(!u)continue;let x=l.source.style,C=n.smoothProperty,G=x.scaleMode!=="nearest";a[C]!==G&&(a[C]=G),n.setBlendMode(e.blendMode);let b=r.globalUniforms.globalUniformData?.worldColor??4294967295,_=h.color,W=(b>>>24&255)/255,T=(_>>>24&255)/255,E=r.filter?.alphaMultiplier??1,N=W*T*E;if(N<=0)continue;a.globalAlpha=N;let ut=b&16777215,I=_&16777215,Y=gt(Q(I,ut)),F=l.frame,rt=x.addressModeU??x.addressMode,X=x.addressModeV??x.addressMode,g=z._getPatternRepeat(rt,X),y=l.source._resolution??l.source.resolution??1,v=h.renderable?.renderGroup?.isCachedAsTexture,L=F.x*y,$=F.y*y,R=F.width*y,q=F.height*y,S=h.bounds,D=r.renderTarget.renderTarget.isRoot,B=S.minX,ot=S.minY,j=S.maxX-S.minX,O=S.maxY-S.minY,P=l.rotate,p=l.uvs,Tt=Math.min(p.x0,p.x1,p.x2,p.x3,p.y0,p.y1,p.y2,p.y3),ke=Math.max(p.x0,p.x1,p.x2,p.x3,p.y0,p.y1,p.y2,p.y3),Ot=g!=="no-repeat"&&(Tt<0||ke>1),Mt=P&&!(!Ot&&(Y!==16777215||P));Mt?(z._tempPatternMatrix.copyFrom(h.transform),w.matrixAppendRotationInv(z._tempPatternMatrix,P,B,ot,j,O),n.setContextTransform(z._tempPatternMatrix,h.roundPixels===1,void 0,v&&D)):n.setContextTransform(h.transform,h.roundPixels===1,void 0,v&&D);let mt=Mt?0:B,ft=Mt?0:ot,St=j,wt=O;if(Ot){let Pt=u,J=Y!==16777215&&!P,K=F.width<=l.source.width&&F.height<=l.source.height;J&&K&&(Pt=d.getTintedCanvas({texture:l},Y));let kt=a.createPattern(Pt,g);if(!kt)continue;let Vt=St,Lt=wt;if(Vt===0||Lt===0)continue;let qt=1/Vt,Nt=1/Lt,Yt=(p.x1-p.x0)*qt,jt=(p.y1-p.y0)*qt,zt=(p.x3-p.x0)*Nt,Xt=(p.y3-p.y0)*Nt,Ie=p.x0-Yt*mt-zt*ft,Re=p.y0-jt*mt-Xt*ft,It=l.source.pixelWidth,Rt=l.source.pixelHeight;z._tempPatternMatrix.set(Yt*It,jt*Rt,zt*It,Xt*Rt,Ie*It,Re*Rt),d.applyPatternTransform(kt,z._tempPatternMatrix),a.fillStyle=kt,a.fillRect(mt,ft,St,wt)}else{let J=Y!==16777215||P?d.getTintedCanvas({texture:l},Y):u,K=J!==u;a.drawImage(J,K?0:L,K?0:$,K?J.width:R,K?J.height:q,mt,ft,St,wt)}}}};At._tempPatternMatrix=new k;At.extension={type:[m.CanvasPipesAdaptor],name:"batch"};var _e=At;var st=class{constructor(t){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=t}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(t,e,o){this._renderer.renderPipes.batch.break(o);let r=this._colorStack;r[this._colorStackIndex]=r[this._colorStackIndex-1]&t.mask;let n=this._colorStack[this._colorStackIndex];n!==this._currentColor&&(this._currentColor=n,o.add({renderPipeId:"colorMask",colorMask:n,canBundle:!1})),this._colorStackIndex++}pop(t,e,o){this._renderer.renderPipes.batch.break(o);let r=this._colorStack;this._colorStackIndex--;let n=r[this._colorStackIndex-1];n!==this._currentColor&&(this._currentColor=n,o.add({renderPipeId:"colorMask",colorMask:n,canBundle:!1}))}execute(t){}destroy(){this._renderer=null,this._colorStack=null}};st.extension={type:[m.CanvasPipes],name:"colorMask"};var Ht=class{constructor(){this.isBatchable=!1}reset(){this.isBatchable=!1,this.context=null,this.graphicsData&&(this.graphicsData.destroy(),this.graphicsData=null)}destroy(){this.reset()}},Ut=class{constructor(){this.instructions=new Qt}init(){this.instructions.reset()}destroy(){this.instructions.destroy(),this.instructions=null}},Et=class Wt{constructor(t){this._renderer=t,this._managedContexts=new Z({renderer:t,type:"resource",name:"graphicsContext"})}init(t){Wt.defaultOptions.bezierSmoothness=t?.bezierSmoothness??Wt.defaultOptions.bezierSmoothness}getContextRenderData(t){return this.getGpuContext(t).graphicsData||this._initContextRenderData(t)}updateGpuContext(t){let e=t._gpuData,o=!!e[this._renderer.uid],r=e[this._renderer.uid]||this._initContext(t);return(t.dirty||!o)&&(o&&r.reset(),r.isBatchable=!1,t.dirty=!1),r}getGpuContext(t){return t._gpuData[this._renderer.uid]||this._initContext(t)}_initContextRenderData(t){let e=new Ut,o=this.getGpuContext(t);return o.graphicsData=e,e.init(),e}_initContext(t){let e=new Ht;return e.context=t,t._gpuData[this._renderer.uid]=e,this._managedContexts.add(t),e}destroy(){this._managedContexts.destroy(),this._renderer=null}};Et.extension={type:[m.CanvasSystem],name:"graphicsContext"};Et.defaultOptions={bezierSmoothness:.5};var ve=Et;var at=class{constructor(t,e){this.state=xt.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new Z({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){return!1}addRenderable(t,e){this._managedGraphics.add(t),this.renderer.renderPipes.batch.break(e),e.add(t)}updateRenderable(t){}execute(t){t.isRenderable&&this._adaptor.execute(this,t)}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null}};at.extension={type:[m.CanvasPipes],name:"graphics"};var Ft=class{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{Gt.return(t)}),this.batches.length=0}},it=class{constructor(t,e){this.state=xt.for2d(),this.renderer=t,this._adaptor=e,this.renderer.runners.contextChange.add(this),this._managedGraphics=new Z({renderer:t,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){let e=t.context,o=!!t._gpuData,n=this.renderer.graphicsContext.updateGpuContext(e);return!!(n.isBatchable||o!==n.isBatchable)}addRenderable(t,e){let r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,e):(this.renderer.renderPipes.batch.break(e),e.add(t))}updateRenderable(t){let o=this._getGpuDataForRenderable(t).batches;for(let r=0;r<o.length;r++){let n=o[r];n._batcher.updateElement(n)}}execute(t){if(!t.isRenderable)return;let e=this.renderer,o=t.context;if(!e.graphicsContext.getGpuContext(o).batches.length)return;let n=o.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;let a=n.resources.localUniforms.uniforms;a.uTransformMatrix=t.groupTransform,a.uRound=e._roundPixels|t._roundPixels,le(t.groupColorAlpha,a.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){let e=this._getGpuDataForRenderable(t),r=this.renderer.graphicsContext.updateGpuContext(t.context);e.destroy(),r.isBatchable&&this._updateBatchesForRenderable(t,e)}_addToBatcher(t,e){let o=this.renderer.renderPipes.batch,r=this._getGpuDataForRenderable(t).batches;for(let n=0;n<r.length;n++){let a=r[n];o.addToBatch(a,e)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){let e=new Ft;return t._gpuData[this.renderer.uid]=e,this._managedGraphics.add(t),e}_updateBatchesForRenderable(t,e){let o=t.context,n=this.renderer.graphicsContext.getGpuContext(o),a=this.renderer._roundPixels|t._roundPixels;e.batches=n.batches.map(i=>{let c=Gt.get(fe);return i.copyTo(c),c.renderable=t,c.roundPixels=a,c})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}};it.extension={type:[m.WebGLPipes,m.WebGPUPipes],name:"graphics"};A.add(at);A.add(it);A.add(ve);A.add(Ce);var vt=class s extends Zt{constructor(t){t instanceof tt&&(t={context:t});let n=t||{},{context:e,roundPixels:o}=n,r=Jt(n,["context","roundPixels"]);super($t({label:"Graphics"},r)),this.renderPipeId="graphics",e?this.context=e:(this.context=this._ownedContext=new tt,this.context.autoGarbageCollect=this.autoGarbageCollect),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=o??!1}set context(t){t!==this._context&&(this._context&&(this._context.off("update",this.onViewUpdate,this),this._context.off("unload",this.unload,this)),this._context=t,this._context.on("update",this.onViewUpdate,this),this._context.on("unload",this.unload,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||t?.context===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_onTouch(t){this._gcLastUsed=t,this._context._gcLastUsed=t}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new s(this._context.clone()):(this._ownedContext=null,new s(this._context))}lineStyle(t,e,o){U(H,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");let r={};return t&&(r.width=t),e&&(r.color=e),o&&(r.alpha=o),this.context.strokeStyle=r,this}beginFill(t,e){U(H,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");let o={};return t!==void 0&&(o.color=t),e!==void 0&&(o.alpha=e),this.context.fillStyle=o,this}endFill(){U(H,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();let t=this.context.strokeStyle;return(t.width!==tt.defaultStrokeStyle.width||t.color!==tt.defaultStrokeStyle.color||t.alpha!==tt.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return U(H,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return U(H,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return U(H,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return U(H,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return U(H,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return U(H,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}};function Fe(s,t,e,o,r,n){n=Math.max(0,Math.min(n,Math.min(o,r)/2)),s.moveTo(t+n,e),s.lineTo(t+o-n,e),s.quadraticCurveTo(t+o,e,t+o,e+n),s.lineTo(t+o,e+r-n),s.quadraticCurveTo(t+o,e+r,t+o-n,e+r),s.lineTo(t+n,e+r),s.quadraticCurveTo(t,e+r,t,e+r-n),s.lineTo(t,e+n),s.quadraticCurveTo(t,e,t+n,e)}function be(s,t){switch(t.type){case"rectangle":{let e=t;s.rect(e.x,e.y,e.width,e.height);break}case"roundedRectangle":{let e=t;Fe(s,e.x,e.y,e.width,e.height,e.radius);break}case"circle":{let e=t;s.moveTo(e.x+e.radius,e.y),s.arc(e.x,e.y,e.radius,0,Math.PI*2);break}case"ellipse":{let e=t;s.ellipse?(s.moveTo(e.x+e.halfWidth,e.y),s.ellipse(e.x,e.y,e.halfWidth,e.halfHeight,0,0,Math.PI*2)):(s.save(),s.translate(e.x,e.y),s.scale(e.halfWidth,e.halfHeight),s.moveTo(1,0),s.arc(0,0,1,0,Math.PI*2),s.restore());break}case"triangle":{let e=t;s.moveTo(e.x,e.y),s.lineTo(e.x2,e.y2),s.lineTo(e.x3,e.y3),s.closePath();break}default:{let e=t,o=e.points;if(!o?.length)break;s.moveTo(o[0],o[1]);for(let r=2;r<o.length;r+=2)s.lineTo(o[r],o[r+1]);e.closePath&&s.closePath();break}}}function Oe(s,t){if(!t?.length)return!1;for(let e=0;e<t.length;e++){let o=t[e];if(!o?.shape)continue;let r=o.transform,n=r&&!r.isIdentity();n&&(s.save(),s.transform(r.a,r.b,r.c,r.d,r.tx,r.ty)),be(s,o.shape),n&&s.restore()}return!0}var ct=class{constructor(t){this._warnedMaskTypes=new Set,this._canvasMaskStack=[],this._renderer=t}push(t,e,o){this._renderer.renderPipes.batch.break(o),o.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:t,inverse:e._maskOptions.inverse,canBundle:!1})}pop(t,e,o){this._renderer.renderPipes.batch.break(o),o.add({renderPipeId:"stencilMask",action:"popMaskEnd",mask:t,inverse:e._maskOptions.inverse,canBundle:!1})}execute(t){if(t.action!=="pushMaskBegin"&&t.action!=="popMaskEnd")return;let e=this._renderer,o=e.canvasContext,r=o?.activeContext;if(!r)return;if(t.action==="popMaskEnd"){this._canvasMaskStack.pop()&&r.restore();return}t.inverse&&this._warnOnce("inverse","CanvasRenderer: inverse masks are not supported on Canvas2D; ignoring inverse flag.");let n=t.mask.mask;if(!(n instanceof vt)){this._warnOnce("nonGraphics","CanvasRenderer: only Graphics masks are supported in Canvas2D; skipping mask."),this._canvasMaskStack.push(!1);return}let a=n,i=a.context?.instructions;if(!i?.length){this._canvasMaskStack.push(!1);return}r.save(),o.setContextTransform(a.groupTransform,(e._roundPixels|a._roundPixels)===1),r.beginPath();let c=!1,h=!1;for(let l=0;l<i.length;l++){let u=i[l],x=u.action;if(x!=="fill"&&x!=="stroke")continue;let G=u.data?.path?.shapePath;if(!G?.shapePrimitives?.length)continue;let b=G.shapePrimitives;for(let _=0;_<b.length;_++){let W=b[_];if(!W?.shape)continue;let T=W.transform,E=T&&!T.isIdentity();E&&(r.save(),r.transform(T.a,T.b,T.c,T.d,T.tx,T.ty)),be(r,W.shape),h=Oe(r,W.holes)||h,c=!0,E&&r.restore()}}if(!c){r.restore(),this._canvasMaskStack.push(!1);return}h?r.clip("evenodd"):r.clip(),this._canvasMaskStack.push(!0)}destroy(){this._renderer=null,this._warnedMaskTypes=null,this._canvasMaskStack=null}_warnOnce(t,e){this._warnedMaskTypes.has(t)||(this._warnedMaskTypes.add(t),Kt(e))}};ct.extension={type:[m.CanvasPipes],name:"stencilMask"};var f="source-over";function Te(){let s=Ct(),t=Object.create(null);return t.inherit=f,t.none=f,t.normal="source-over",t.add="lighter",t.multiply=s?"multiply":f,t.screen=s?"screen":f,t.overlay=s?"overlay":f,t.darken=s?"darken":f,t.lighten=s?"lighten":f,t["color-dodge"]=s?"color-dodge":f,t["color-burn"]=s?"color-burn":f,t["hard-light"]=s?"hard-light":f,t["soft-light"]=s?"soft-light":f,t.difference=s?"difference":f,t.exclusion=s?"exclusion":f,t.saturation=s?"saturation":f,t.color=s?"color":f,t.luminosity=s?"luminosity":f,t["linear-burn"]=s?"color-burn":f,t["linear-dodge"]=s?"color-dodge":f,t["linear-light"]=s?"hard-light":f,t["pin-light"]=s?"hard-light":f,t["vivid-light"]=s?"hard-light":f,t["hard-mix"]=f,t.negation=s?"difference":f,t["normal-npm"]=t.normal,t["add-npm"]=t.add,t["screen-npm"]=t.screen,t.erase="destination-out",t.subtract=f,t.divide=f,t.min=f,t.max=f,t}var Ve=new k,lt=class{constructor(t){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=Te(),this._activeBlendMode="normal",this._projTransform=null,this._outerBlend=!1,this._warnedBlendModes=new Set,this._renderer=t}resolutionChange(t){this.activeResolution=t}init(){let t=this._renderer.background.alpha<1;if(this.rootContext=this._renderer.canvas.getContext("2d",{alpha:t}),this.activeContext=this.rootContext,this.activeResolution=this._renderer.resolution,!this.rootContext.imageSmoothingEnabled){let e=this.rootContext;e.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":e.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":e.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":e.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(t,e,o,r){let n=r?k.IDENTITY:this._renderer.globalUniforms.globalUniformData?.worldTransformMatrix||k.IDENTITY,a=Ve;a.copyFrom(n),a.append(t);let i=this._projTransform,c=this.activeResolution;if(o=o||c,i){let h=k.shared;h.copyFrom(a),h.prepend(i),a=h}e?this.activeContext.setTransform(a.a*o,a.b*o,a.c*o,a.d*o,a.tx*c|0,a.ty*c|0):this.activeContext.setTransform(a.a*o,a.b*o,a.c*o,a.d*o,a.tx*c,a.ty*c)}clear(t,e){let o=this.activeContext,r=this._renderer;if(o.clearRect(0,0,r.width,r.height),t){let n=V.shared.setValue(t);o.globalAlpha=e??n.alpha,o.fillStyle=n.toHex(),o.fillRect(0,0,r.width,r.height),o.globalAlpha=1}}setBlendMode(t){if(this._activeBlendMode===t)return;this._activeBlendMode=t,this._outerBlend=!1;let e=this.blendModes[t];if(!e){this._warnedBlendModes.has(t)||(console.warn(`CanvasRenderer: blend mode "${t}" is not supported in Canvas2D; falling back to "source-over".`),this._warnedBlendModes.add(t)),this.activeContext.globalCompositeOperation="source-over";return}this.activeContext.globalCompositeOperation=e}destroy(){this.rootContext=null,this.activeContext=null,this._warnedBlendModes.clear()}};lt.extension={type:[m.CanvasSystem],name:"canvasContext"};var ht=class{constructor(){this.maxTextures=16,this.maxBatchableTextures=16,this.maxUniformBindings=0}init(){}};ht.extension={type:[m.CanvasSystem],name:"limits"};var bt=class{init(t,e){this._renderer=t,this._renderTargetSystem=e}initGpuRenderTarget(t){let e=t.colorTexture,{canvas:o,context:r}=this._ensureCanvas(e);return{canvas:o,context:r,width:o.width,height:o.height}}resizeGpuRenderTarget(t){let e=t.colorTexture,{canvas:o}=this._ensureCanvas(e);o.width=t.pixelWidth,o.height=t.pixelHeight}startRenderPass(t,e,o,r){let n=this._renderTargetSystem.getGpuRenderTarget(t);this._renderer.canvasContext.activeContext=n.context,this._renderer.canvasContext.activeResolution=t.resolution,e&&this.clear(t,e,o,r)}clear(t,e,o,r){let a=this._renderTargetSystem.getGpuRenderTarget(t).context,i=r||{x:0,y:0,width:t.pixelWidth,height:t.pixelHeight};if(a.setTransform(1,0,0,1,0,0),a.clearRect(i.x,i.y,i.width,i.height),o){let c=V.shared.setValue(o);c.alpha>0&&(a.globalAlpha=c.alpha,a.fillStyle=c.toHex(),a.fillRect(i.x,i.y,i.width,i.height),a.globalAlpha=1)}}finishRenderPass(){}copyToTexture(t,e,o,r,n){let i=this._renderTargetSystem.getGpuRenderTarget(t).canvas,c=e.source,{context:h}=this._ensureCanvas(c),l=n?.x??0,u=n?.y??0;return h.drawImage(i,o.x,o.y,r.width,r.height,l,u,r.width,r.height),c.update(),e}destroyGpuRenderTarget(t){}_ensureCanvas(t){let e=t.resource;(!e||!te.test(e))&&(e=M.get().createCanvas(t.pixelWidth,t.pixelHeight),t.resource=e),(e.width!==t.pixelWidth||e.height!==t.pixelHeight)&&(e.width=t.pixelWidth,e.height=t.pixelHeight);let o=e.getContext("2d");return{canvas:e,context:o}}};var dt=class extends de{constructor(t){super(t),this.adaptor=new bt,this.adaptor.init(t,this)}};dt.extension={type:[m.CanvasSystem],name:"renderTarget"};var pt=class{constructor(t){}init(){}initSource(t){}generateCanvas(t){let e=M.get().createCanvas(),o=e.getContext("2d"),r=d.getCanvasSource(t);if(!r)return e;let n=t.frame,a=t.source._resolution??t.source.resolution??1,i=n.x*a,c=n.y*a,h=n.width*a,l=n.height*a;return e.width=Math.ceil(h),e.height=Math.ceil(l),o.drawImage(r,i,c,h,l,0,0,h,l),e}getPixels(t){let e=this.generateCanvas(t);return{pixels:e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height).data,width:e.width,height:e.height}}destroy(){}};pt.extension={type:[m.CanvasSystem],name:"texture"};var Le=[...he,lt,ht,pt,dt],qe=[ce,ae,se,ne,ie,ct,st,oe],Ne=[_e,nt],Se=[],we=[],Pe=[];A.handleByNamedList(m.CanvasSystem,Se);A.handleByNamedList(m.CanvasPipes,we);A.handleByNamedList(m.CanvasPipesAdaptor,Pe);A.add(...Le,...qe,...Ne);var Me=class extends re{constructor(){let t={name:"canvas",type:ee.CANVAS,systems:Se,renderPipes:we,renderPipeAdaptors:Pe};super(t)}};export{vt as a,Me as b};
