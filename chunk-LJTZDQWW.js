import{a as A}from"./chunk-PKO5ZNGR.js";import{a as V}from"./chunk-FDDRA6DH.js";import{a as P}from"./chunk-CTRNHETA.js";import{$ as T,A as v,B as d,C as r,D as a,E as g,K as C,M as u,O as f,P as I,Q as D,R as M,T as x,U as c,V as R,W as _,Z as O,aa as N,ba as z,g as b,ga as F,h as w,o as m,r as S,s as k,u as s,x as h,y as E}from"./chunk-NSEKHPH4.js";import"./chunk-C6Q5SG76.js";var U=["fogCanvas"];function B(i,e){if(i&1){let n=C();r(0,"button",16),u("click",function(){let o=b(n).$implicit,l=f();return w(l.selectOption(o))}),c(1),a()}if(i&2){let n=e.$implicit,t=f();x("bg-pink-500",t.selectedOption()===n)("text-white",t.selectedOption()===n)("bg-white",t.selectedOption()!==n),d("disabled",t.isLevelComplete()),s(),_(" ",n," ")}}function W(i,e){if(i&1&&(r(0,"div",17),c(1),a()),i&2){let n=f();s(),_(" ",n.feedbackMessage()," ")}}function Q(i,e){i&1&&(r(0,"div",18)(1,"p"),c(2,"The Forest is foggy..."),a()())}function q(i,e){if(i&1){let n=C();r(0,"app-level-completion",19),u("onContinue",function(){b(n);let o=f();return w(o.continueToNextLevel())}),a()}}var H=class i{constructor(e,n,t){this.router=e;this.gameState=n;this.assetLoader=t}canvasRef;fogCleared=m(!1);selectedOption=m(null);feedbackMessage=m("");isLevelComplete=m(!1);showCompletion=m(!1);options=["Hide","Show Up","Run"];ctx;isDrawing=!1;companionImage=O(()=>{let e=this.gameState.companion(),n=this.gameState.mood(),t="idle";switch(n){case"Soft":t="idle";break;case"Boss":t="victorious";break;case"Mischief":t="happy";break;case"Overthink":t="thinking";break;default:t="idle"}return this.assetLoader.getCharacterImage(e,t)});ngOnInit(){this.gameState.currentLevel.set(2)}ngAfterViewInit(){this.initCanvas()}initCanvas(){let e=this.canvasRef.nativeElement;this.ctx=e.getContext("2d",{willReadFrequently:!0}),this.resizeCanvas(),this.drawFog(),e.addEventListener("mousedown",this.startDrawing.bind(this)),e.addEventListener("mousemove",this.draw.bind(this)),e.addEventListener("mouseup",this.stopDrawing.bind(this)),e.addEventListener("touchstart",this.startDrawing.bind(this),{passive:!1}),e.addEventListener("touchmove",this.draw.bind(this),{passive:!1}),e.addEventListener("touchend",this.stopDrawing.bind(this))}resizeCanvas(){if(!this.canvasRef)return;let e=this.canvasRef.nativeElement;e.width=window.innerWidth,e.height=window.innerHeight,this.fogCleared()||this.drawFog()}drawFog(){this.ctx.fillStyle="#9ca3af",this.ctx.fillRect(0,0,this.canvasRef.nativeElement.width,this.canvasRef.nativeElement.height),this.ctx.font="30px sans-serif",this.ctx.fillStyle="#ffffff",this.ctx.textAlign="center",this.ctx.fillText("Can't see clearly...",this.canvasRef.nativeElement.width/2,this.canvasRef.nativeElement.height/2)}startDrawing(e){e.preventDefault(),this.isDrawing=!0,this.draw(e)}stopDrawing(){this.isDrawing=!1,this.checkFogClearance()}draw(e){if(!this.isDrawing||this.fogCleared())return;e.preventDefault();let t=this.canvasRef.nativeElement.getBoundingClientRect(),o,l;e instanceof MouseEvent?(o=e.clientX-t.left,l=e.clientY-t.top):(o=e.touches[0].clientX-t.left,l=e.touches[0].clientY-t.top),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(o,l,40,0,Math.PI*2),this.ctx.fill()}checkFogClearance(){if(this.fogCleared())return;let e=this.canvasRef.nativeElement,n=e.width,t=e.height,l=this.ctx.getImageData(0,0,n,t).data,y=0,L=50;for(let p=0;p<l.length;p+=4*L)l[p+3]===0&&y++;let j=l.length/(4*L);if(y/j>.4){this.fogCleared.set(!0);let p=document.querySelector(".content-container");p&&p.classList.add("interactive")}}selectOption(e){this.isLevelComplete()||(this.selectedOption.set(e),e==="Show Up"?this.handleWin():(this.gameState.decreaseLife(),this.feedbackMessage.set("Try again... that creates distance."),setTimeout(()=>this.feedbackMessage.set(""),2e3)))}handleWin(){this.isLevelComplete.set(!0),this.feedbackMessage.set(""),this.gameState.addToInventory("Show-Up Shield"),setTimeout(()=>{this.showCompletion.set(!0)},1500)}continueToNextLevel(){this.router.navigate(["/valentine/level-3"])}static \u0275fac=function(n){return new(n||i)(h(F),h(P),h(V))};static \u0275cmp=E({type:i,selectors:[["app-level-2"]],viewQuery:function(n,t){if(n&1&&I(U,5),n&2){let o;D(o=M())&&(t.canvasRef=o.first)}},hostBindings:function(n,t){n&1&&u("resize",function(){return t.resizeCanvas()},k)},decls:20,vars:15,consts:[["fogCanvas",""],[1,"relative","w-full","h-screen","overflow-hidden","bg-slate-900"],[1,"absolute","inset-0","z-0","bg-cover","bg-center",2,"background-image","url('/assets/bg_fog_bridge.jpg')"],[1,"absolute","inset-0","z-0","content-container","flex","flex-col","items-center","justify-center"],[1,"bg-white/95","p-8","rounded-3xl","shadow-2xl","max-w-2xl","w-full","border-4","border-pink-200","mx-4","transform","transition-all","duration-500","relative","z-20"],[1,"text-3xl","font-bold","text-pink-600","mb-6","text-center"],[1,"text-2xl","text-gray-700","mb-8","font-medium","leading-relaxed","text-center"],[1,"border-b-4","border-pink-400","font-bold","text-pink-600","px-2","inline-block","min-w-[100px]","text-center"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],["class","py-4 px-6 rounded-2xl border-2 border-pink-300 font-bold text-lg transition-all hover:scale-105 active:scale-95 shadow-md text-pink-700",3,"disabled","bg-pink-500","text-white","bg-white","click",4,"ngFor","ngForOf"],["class","mt-6 text-center text-xl font-bold animate-bounce text-red-500",4,"ngIf"],[1,"absolute","bottom-0","right-4","md:right-10","z-10","w-40","md:w-60","pointer-events-none","filter","drop-shadow-2xl"],[1,"w-full","object-contain",3,"src","alt"],[1,"absolute","inset-0","z-30","touch-none","cursor-crosshair","transition-opacity","duration-1000"],["class","absolute top-1/4 left-1/2 transform -translate-x-1/2 z-40 pointer-events-none text-white text-opacity-90 font-bold text-2xl animate-pulse drop-shadow-md text-center",4,"ngIf"],["itemName","Show-Up Shield","itemImage","assets/icon_shield.png","itemDescription","It protects your peace when you show up for yourself.",3,"onContinue",4,"ngIf"],[1,"py-4","px-6","rounded-2xl","border-2","border-pink-300","font-bold","text-lg","transition-all","hover:scale-105","active:scale-95","shadow-md","text-pink-700",3,"click","disabled"],[1,"mt-6","text-center","text-xl","font-bold","animate-bounce","text-red-500"],[1,"absolute","top-1/4","left-1/2","transform","-translate-x-1/2","z-40","pointer-events-none","text-white","text-opacity-90","font-bold","text-2xl","animate-pulse","drop-shadow-md","text-center"],["itemName","Show-Up Shield","itemImage","assets/icon_shield.png","itemDescription","It protects your peace when you show up for yourself.",3,"onContinue"]],template:function(n,t){n&1&&(r(0,"div",1),g(1,"div",2),r(2,"div",3)(3,"div",4)(4,"h2",5),c(5,"Clear the Mind Fog"),a(),r(6,"p",6),c(7,' "When I feel unsure, I will '),r(8,"span",7),c(9),a(),c(10,' for myself." '),a(),r(11,"div",8),v(12,B,2,8,"button",9),a(),v(13,W,2,1,"div",10),a(),r(14,"div",11),g(15,"img",12),a()(),g(16,"canvas",13,0),v(18,Q,3,0,"div",14)(19,q,1,0,"app-level-completion",15),a()),n&2&&(s(3),x("scale-95",!t.fogCleared())("blur-sm",!t.fogCleared()),s(6),R(t.selectedOption()||"\xA0"),s(3),d("ngForOf",t.options),s(),d("ngIf",t.feedbackMessage()&&!t.isLevelComplete()),s(2),d("src",t.companionImage(),S)("alt",t.gameState.companion()),s(),x("pointer-events-none",t.fogCleared())("opacity-0",t.fogCleared()),s(2),d("ngIf",!t.fogCleared()),s(),d("ngIf",t.showCompletion()))},dependencies:[z,T,N,A],styles:["[_nghost-%COMP%]{display:block;height:100vh}.content-container[_ngcontent-%COMP%]{pointer-events:none}.content-container.interactive[_ngcontent-%COMP%]{pointer-events:auto}"]})};export{H as Level2Component};
