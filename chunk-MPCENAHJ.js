import"./chunk-VWNVGPUS.js";import{a as U}from"./chunk-ZPSUSOTR.js";import{a as D,b as Xe,c as O,d as ue}from"./chunk-XS3JS5D4.js";import{j as Ft}from"./chunk-2A7FCI3D.js";import{a as xt,b as gt}from"./chunk-NLDPNQFE.js";import{F as nt,G as pt,H as lt,M as mt,P as ct,Q as ft,R as dt,ba as ht,ga as ut,s as it,x as _e,y as at}from"./chunk-NSEKHPH4.js";import"./chunk-BSP2VVC5.js";import{a as E,b as L,c as Ce,d as $,e as St,f as wt,g as he}from"./chunk-GU3F2VZO.js";import{a as re,b as B}from"./chunk-EGYWD4KQ.js";import{a as Be}from"./chunk-EMBPV7JI.js";import"./chunk-T2MU44FD.js";import"./chunk-Z3VDB3D7.js";import{c as Pe,e as Ct,h as Bt}from"./chunk-TPSZSGEE.js";import{a as je}from"./chunk-MOVKKYQE.js";import"./chunk-GRDDIUM7.js";import{o as Pt}from"./chunk-DL7DH7M3.js";import{a as vt,j as we,o as C,p as At,q as Ne,r as bt,s as _t,t as F}from"./chunk-FEUSPEM3.js";import{A as I,B as y,a as d,b as A,d as yt,j as fe,l as K,m as P,p as de,q as Tt,t as ze,v as ie}from"./chunk-AOUDBIVJ.js";import{a as x,b as te,c as be}from"./chunk-C6Q5SG76.js";var Et={extension:{type:d.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await import("./chunk-7NWMJ2UN.js")}};var Lt={extension:{type:d.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await import("./chunk-E3OTKIUR.js")}};var Fe;function Gt(o){return Fe!==void 0||(Fe=(()=>{let e={stencil:!0,failIfMajorPerformanceCaveat:o??Pe.defaultOptions.failIfMajorPerformanceCaveat};try{if(!y.get().getWebGLRenderingContext())return!1;let r=y.get().createCanvas().getContext("webgl",e),s=!!r?.getContextAttributes()?.stencil;if(r){let i=r.getExtension("WEBGL_lose_context");i&&i.loseContext()}return r=null,s}catch{return!1}})()),Fe}var Ee;async function Mt(o={}){return Ee!==void 0||(Ee=await(async()=>{let e=y.get().getNavigator().gpu;if(!e)return!1;try{return await(await e.requestAdapter(o)).requestDevice(),!0}catch{return!1}})()),Ee}var Rt=["webgl","webgpu","canvas"];async function kt(o){let e=[];o.preference?(e.push(o.preference),Rt.forEach(i=>{i!==o.preference&&e.push(i)})):e=Rt.slice();let t,r={};for(let i=0;i<e.length;i++){let n=e[i];if(n==="webgpu"&&await Mt()){let{WebGPURenderer:a}=await import("./chunk-NQVA7CYR.js");t=a,r=x(x({},o),o.webgpu);break}else if(n==="webgl"&&Gt(o.failIfMajorPerformanceCaveat??Pe.defaultOptions.failIfMajorPerformanceCaveat)){let{WebGLRenderer:a}=await import("./chunk-FFGKP6WK.js");t=a,r=x(x({},o),o.webgl);break}else if(n==="canvas"){let{CanvasRenderer:a}=await import("./chunk-DRIA5B54.js");t=a,r=x(x({},o),o.canvasOptions);break}}if(delete r.webgpu,delete r.webgl,delete r.canvasOptions,!t)throw new Error("No available renderer for the current environment");let s=new t;return await s.init(r),s}var xe=class{static init(e){Object.defineProperty(this,"resizeTo",{configurable:!0,set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let t,r;if(this._resizeTo===globalThis.window)t=globalThis.innerWidth,r=globalThis.innerHeight;else{let{clientWidth:s,clientHeight:i}=this._resizeTo;t=s,r=i}this.renderer.resize(t,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}};xe.extension=d.Application;var ge=class{static init(e){e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{configurable:!0,set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,At.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Ne.shared:new Ne,e.autoStart&&this.start()}static destroy(){if(this._ticker){let e=this._ticker;this.ticker=null,e.destroy()}}};ge.extension=d.Application;A.add(xe);A.add(ge);var fr=(()=>{let o=class qe{constructor(...t){this.stage=new C,t[0]!==void 0&&K(fe,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t=x({},t),this.stage||(this.stage=new C),this.renderer=await kt(t),qe._plugins.forEach(r=>{r.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return K(fe,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,r=!1){let s=qe._plugins.slice(0);s.reverse(),s.forEach(i=>{i.destroy.call(this)}),this.stage.destroy(r),this.stage=null,this.renderer.destroy(t),this.renderer=null}};return o._plugins=[],o})(),Le=fr;A.handleByList(d.Application,Le._plugins);A.add(Bt);var Ge={test(o){return typeof o=="string"&&o.startsWith("info face=")},parse(o){let e=o.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(let c in e){let f=e[c].match(/^[a-z]+/gm)[0],h=e[c].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(let S in h){let g=h[S].split("="),T=g[0],W=g[1].replace(/"/gm,""),se=parseFloat(W),_=isNaN(se)?W:se;u[T]=_}t[f].push(u)}let r={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[s]=t.info,[i]=t.common,[n]=t.distanceField??[];n&&(r.distanceField={range:parseInt(n.distanceRange,10),type:n.fieldType}),r.fontSize=parseInt(s.size,10),r.fontFamily=s.face,r.lineHeight=parseInt(i.lineHeight,10);let a=t.page;for(let c=0;c<a.length;c++)r.pages.push({id:parseInt(a[c].id,10)||0,file:a[c].file});let p={};r.baseLineOffset=r.lineHeight-parseInt(i.base,10);let l=t.char;for(let c=0;c<l.length;c++){let f=l[c],h=parseInt(f.id,10),u=f.letter??f.char??String.fromCharCode(h);u==="space"&&(u=" "),p[h]=u,r.chars[u]={id:h,page:parseInt(f.page,10)||0,x:parseInt(f.x,10),y:parseInt(f.y,10),width:parseInt(f.width,10),height:parseInt(f.height,10),xOffset:parseInt(f.xoffset,10),yOffset:parseInt(f.yoffset,10),xAdvance:parseInt(f.xadvance,10),kerning:{}}}let m=t.kerning||[];for(let c=0;c<m.length;c++){let f=parseInt(m[c].first,10),h=parseInt(m[c].second,10),u=parseInt(m[c].amount,10);r.chars[p[h]].kerning[p[f]]=u}return r}};var Ke={test(o){let e=o;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(o){let e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},t=o.getElementsByTagName("info")[0],r=o.getElementsByTagName("common")[0],s=o.getElementsByTagName("distanceField")[0];s&&(e.distanceField={type:s.getAttribute("fieldType"),range:parseInt(s.getAttribute("distanceRange"),10)});let i=o.getElementsByTagName("page"),n=o.getElementsByTagName("char"),a=o.getElementsByTagName("kerning");e.fontSize=parseInt(t.getAttribute("size"),10),e.fontFamily=t.getAttribute("face"),e.lineHeight=parseInt(r.getAttribute("lineHeight"),10);for(let l=0;l<i.length;l++)e.pages.push({id:parseInt(i[l].getAttribute("id"),10)||0,file:i[l].getAttribute("file")});let p={};e.baseLineOffset=e.lineHeight-parseInt(r.getAttribute("base"),10);for(let l=0;l<n.length;l++){let m=n[l],c=parseInt(m.getAttribute("id"),10),f=m.getAttribute("letter")??m.getAttribute("char")??String.fromCharCode(c);f==="space"&&(f=" "),p[c]=f,e.chars[f]={id:c,page:parseInt(m.getAttribute("page"),10)||0,x:parseInt(m.getAttribute("x"),10),y:parseInt(m.getAttribute("y"),10),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10),xOffset:parseInt(m.getAttribute("xoffset"),10),yOffset:parseInt(m.getAttribute("yoffset"),10),xAdvance:parseInt(m.getAttribute("xadvance"),10),kerning:{}}}for(let l=0;l<a.length;l++){let m=parseInt(a[l].getAttribute("first"),10),c=parseInt(a[l].getAttribute("second"),10),f=parseInt(a[l].getAttribute("amount"),10);e.chars[p[c]].kerning[p[m]]=f}return e}};var $e={test(o){return typeof o=="string"&&o.match(/<font(\s|>)/)?Ke.test(y.get().parseXML(o)):!1},parse(o){return Ke.parse(y.get().parseXML(o))}};var dr=[".xml",".fnt"],It={extension:{type:d.CacheParser,name:"cacheBitmapFont"},test:o=>!!o?.pages&&!!o?.chars&&typeof o?.fontFamily=="string",getCacheableAssets(o,e){let t={};return o.forEach(r=>{t[r]=e,t[`${r}-bitmap`]=e}),t[`${e.fontFamily}-bitmap`]=e,t}},Ut={extension:{type:d.LoadParser,priority:E.Normal},name:"loadBitmapFont",id:"bitmap-font",test(o){return dr.includes(L.extname(o).toLowerCase())},async testParse(o){return Ge.test(o)||$e.test(o)},async parse(o,e,t){let r=Ge.test(o)?Ge.parse(o):$e.parse(o),{src:s}=e,{pages:i}=r,n=[],a=r.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let f=0;f<i.length;++f){let h=i[f].file,u=L.join(L.dirname(s),h);u=St(u,s),n.push({src:u,data:a})}let[p,{BitmapFont:l}]=await Promise.all([t.load(n),import("./chunk-2NSB5XWR.js")]),m=n.map(f=>p[f.src]);return new l({data:r,textures:m},s)},async load(o,e){return await(await y.get().fetch(o)).text()},async unload(o,e,t){await Promise.all(o.pages.map(r=>t.unload(r.texture.source._sourceOrigin))),o.destroy()}};var Me=class{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;let e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<t;r++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}};var Dt={extension:{type:d.CacheParser,name:"cacheTextureArray"},test:o=>Array.isArray(o)&&o.every(e=>e instanceof I),getCacheableAssets:(o,e)=>{let t={};return o.forEach(r=>{e.forEach((s,i)=>{t[r+(i===0?"":i+1)]=s})}),t}};async function Re(o){if("Image"in globalThis)return new Promise(e=>{let t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=o});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{let e=await(await fetch(o)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}var Ot={extension:{type:d.DetectionParser,priority:1},test:async()=>Re("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async o=>[...o,"avif"],remove:async o=>o.filter(e=>e!=="avif")};var Wt=["png","jpg","jpeg"],Vt={extension:{type:d.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async o=>[...o,...Wt],remove:async o=>o.filter(e=>!Wt.includes(e))};var hr="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Y(o){return hr?!1:document.createElement("video").canPlayType(o)!==""}var Ht={extension:{type:d.DetectionParser,priority:0},test:async()=>Y("video/mp4"),add:async o=>[...o,"mp4","m4v"],remove:async o=>o.filter(e=>e!=="mp4"&&e!=="m4v")};var zt={extension:{type:d.DetectionParser,priority:0},test:async()=>Y("video/ogg"),add:async o=>[...o,"ogv"],remove:async o=>o.filter(e=>e!=="ogv")};var Nt={extension:{type:d.DetectionParser,priority:0},test:async()=>Y("video/webm"),add:async o=>[...o,"webm"],remove:async o=>o.filter(e=>e!=="webm")};var jt={extension:{type:d.DetectionParser,priority:0},test:async()=>Re("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async o=>[...o,"webp"],remove:async o=>o.filter(e=>e!=="webp")};var ur=(()=>{let o=class ke{constructor(){this.loadOptions=x({},ke.defaultOptions),this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,r,s)=>(this._parsersValidated=!1,t[r]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,r){let s={promise:null,parser:null};return s.promise=(async()=>{let i=null,n=null;if((r.parser||r.loadParser)&&(n=this._parserHash[r.parser||r.loadParser],r.loadParser&&P(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),n||P(`[Assets] specified load parser "${r.parser||r.loadParser}" not found while loading ${t}`)),!n){for(let a=0;a<this.parsers.length;a++){let p=this.parsers[a];if(p.load&&p.test?.(t,r,this)){n=p;break}}if(!n)return P(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}i=await n.load(t,r,this),s.parser=n;for(let a=0;a<this.parsers.length;a++){let p=this.parsers[a];p.parse&&p.parse&&await p.testParse?.(i,r,this)&&(i=await p.parse(i,r,this)||i,s.parser=p)}return i})(),s}async load(t,r){this._parsersValidated||this._validateParsers();let s=typeof r=="function"?te(x(x({},ke.defaultOptions),this.loadOptions),{onProgress:r}):x(x(x({},ke.defaultOptions),this.loadOptions),r||{}),{onProgress:i,onError:n,strategy:a,retryCount:p,retryDelay:l}=s,m=0,c={},f=Ce(t),h=re(t,g=>({alias:[g],src:g,data:{}})),u=h.reduce((g,T)=>g+(T.progressSize||1),0),S=h.map(async g=>{let T=L.toAbsolute(g.src);c[g.src]||(await this._loadAssetWithRetry(T,g,{onProgress:i,onError:n,strategy:a,retryCount:p,retryDelay:l},c),m+=g.progressSize||1,i&&i(m/u))});return await Promise.all(S),f?c[h[0].src]:c}async unload(t){let s=re(t,i=>({alias:[i],src:i})).map(async i=>{let n=L.toAbsolute(i.src),a=this.promiseCache[n];if(a){let p=await a.promise;delete this.promiseCache[n],await a.parser?.unload?.(p,i,this)}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,r)=>(!r.name&&!r.id?P("[Assets] parser should have an id"):(t[r.name]||t[r.id])&&P(`[Assets] parser id conflict "${r.id}"`),t[r.name]=r,r.id&&(t[r.id]=r),t),{})}async _loadAssetWithRetry(t,r,s,i){let n=0,{onError:a,strategy:p,retryCount:l,retryDelay:m}=s,c=f=>new Promise(h=>setTimeout(h,f));for(;;)try{this.promiseCache[t]||(this.promiseCache[t]=this._getLoadPromiseAndParser(t,r)),i[r.src]=await this.promiseCache[t].promise;return}catch(f){delete this.promiseCache[t],delete i[r.src],n++;let h=p!=="retry"||n>l;if(p==="retry"&&!h){a&&a(f,r),await c(m);continue}if(p==="skip"){a&&a(f,r);return}a&&a(f,r);let u=new Error(`[Loader.load] Failed to load ${t}.
${f}`);throw f instanceof Error&&f.stack&&(u.stack=f.stack),u}}};return o.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250},o})(),Xt=ur;function G(o,e){if(Array.isArray(e)){for(let t of e)if(o.startsWith(`data:${t}`))return!0;return!1}return o.startsWith(`data:${e}`)}function M(o,e){let t=o.split("?")[0],r=L.extname(t).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}var xr=".json",gr="application/json",qt={extension:{type:d.LoadParser,priority:E.Low},name:"loadJson",id:"json",test(o){return G(o,gr)||M(o,xr)},async load(o){return await(await y.get().fetch(o)).json()}};var yr=".txt",vr="text/plain",Kt={name:"loadTxt",id:"text",extension:{type:d.LoadParser,priority:E.Low,name:"loadTxt"},test(o){return G(o,vr)||M(o,yr)},async load(o){return await(await y.get().fetch(o)).text()}};var Tr=["normal","bold","100","200","300","400","500","600","700","800","900"],Ar=[".ttf",".otf",".woff",".woff2"],Sr=["font/ttf","font/otf","font/woff","font/woff2"],br=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function _r(o){let e=L.extname(o),s=L.basename(o,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)),i=s.length>0;for(let a of s)if(!a.match(br)){i=!1;break}let n=s.join(" ");return i||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}var wr=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Cr(o){return wr.test(o)?o:encodeURI(o)}var $t={extension:{type:d.LoadParser,priority:E.Low},name:"loadWebFont",id:"web-font",test(o){return G(o,Sr)||M(o,Ar)},async load(o,e){let t=y.get().getFontFaceSet();if(t){let r=[],s=e.data?.family??_r(o),i=e.data?.weights?.filter(a=>Tr.includes(a))??["normal"],n=e.data??{};for(let a=0;a<i.length;a++){let p=i[a],l=new FontFace(s,`url(${Cr(o)})`,te(x({},n),{weight:p}));await l.load(),t.add(l),r.push(l)}return B.has(`${s}-and-url`)?B.get(`${s}-and-url`).entries.push({url:o,faces:r}):B.set(`${s}-and-url`,{entries:[{url:o,faces:r}]}),r.length===1?r[0]:r}return P("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(o){let e=Array.isArray(o)?o:[o],t=e[0].family,r=B.get(`${t}-and-url`),s=r.entries.find(i=>i.faces.some(n=>e.indexOf(n)!==-1));s.faces=s.faces.filter(i=>e.indexOf(i)===-1),s.faces.length===0&&(r.entries=r.entries.filter(i=>i!==s)),e.forEach(i=>{y.get().getFontFaceSet().delete(i)}),r.entries.length===0&&B.remove(`${t}-and-url`)}};function ae(o,e=1){let t=$.RETINA_PREFIX?.exec(o);return t?parseFloat(t[1]):e}function ne(o,e,t){o.label=t,o._sourceOrigin=t;let r=new I({source:o,label:t}),s=()=>{delete e.promiseCache[t],B.has(t)&&B.remove(t)};return r.source.once("destroy",()=>{e.promiseCache[t]&&(P("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),s())}),r.once("destroy",()=>{o.destroyed||(P("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),s())}),r}var Br=".svg",Pr="image/svg+xml",Yt={extension:{type:d.LoadParser,priority:E.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(o){return G(o,Pr)||M(o,Br)},async load(o,e,t){return e.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?Er(o):Fr(o,e,t,this.config.crossOrigin)},unload(o){o.destroy(!0)}};async function Fr(o,e,t,r){let s=await y.get().fetch(o),i=y.get().createImage();i.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await s.text())}`,i.crossOrigin=r,await i.decode();let n=e.data?.width??i.width,a=e.data?.height??i.height,p=e.data?.resolution||ae(o),l=Math.ceil(n*p),m=Math.ceil(a*p),c=y.get().createCanvas(l,m),f=c.getContext("2d");f.imageSmoothingEnabled=!0,f.imageSmoothingQuality="high",f.drawImage(i,0,0,n*p,a*p);let g=e.data??{},{parseAsGraphicsContext:h}=g,u=be(g,["parseAsGraphicsContext"]),S=new Be(x({resource:c,alphaMode:"premultiply-alpha-on-upload",resolution:p},u));return ne(S,t,o)}async function Er(o){let t=await(await y.get().fetch(o)).text(),r=new Ft;return r.svg(t),r}var Lr=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function") return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`,pe=null,Ye=(()=>{class o{constructor(){pe||(pe=URL.createObjectURL(new Blob([Lr],{type:"application/javascript"}))),this.worker=new Worker(pe)}}return o.revokeObjectURL=function(){pe&&(URL.revokeObjectURL(pe),pe=null)},o})();var Gr=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`,le=null,Qt=(()=>{class o{constructor(){le||(le=URL.createObjectURL(new Blob([Gr],{type:"application/javascript"}))),this.worker=new Worker(le)}}return o.revokeObjectURL=function(){le&&(URL.revokeObjectURL(le),le=null)},o})();var Jt=0,Qe,Je=class{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{let{worker:t}=new Ye;t.addEventListener("message",r=>{t.terminate(),Ye.revokeObjectURL(),e(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,t){return this._run("loadImageBitmap",[e,t?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){Qe===void 0&&(Qe=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<Qe&&(this._createdWorkers++,e=new Qt().worker,e.addEventListener("message",t=>{this._complete(t.data),this._returnWorker(t.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){this._resolveHash[e.uuid]&&(e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),delete this._resolveHash[e.uuid])}async _run(e,t){await this._initWorkers();let r=new Promise((s,i)=>{this._queue.push({id:e,arguments:t,resolve:s,reject:i})});return this._next(),r}_next(){if(!this._queue.length)return;let e=this._getWorker();if(!e)return;let t=this._queue.pop(),r=t.id;this._resolveHash[Jt]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:Jt++,id:r})}reset(){this._workerPool.forEach(e=>e.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:e})=>{e?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}},Ze=new Je;var Mr=[".jpeg",".jpg",".png",".webp",".avif"],Rr=["image/jpeg","image/png","image/webp","image/avif"];async function kr(o,e){let t=await y.get().fetch(o);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${o}: ${t.status} ${t.statusText}`);let r=await t.blob();return e?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(r,{premultiplyAlpha:"none"}):createImageBitmap(r)}var Ie={name:"loadTextures",id:"texture",extension:{type:d.LoadParser,priority:E.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(o){return G(o,Rr)||M(o,Mr)},async load(o,e,t){let r=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Ze.isImageBitmapSupported()?r=await Ze.loadImageBitmap(o,e):r=await kr(o,e):r=await new Promise((i,n)=>{r=y.get().createImage(),r.crossOrigin=this.config.crossOrigin,r.src=o,r.complete?i(r):(r.onload=()=>{i(r)},r.onerror=n)});let s=new Be(x({resource:r,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||ae(o)},e.data));return ne(s,t,o)},unload(o){o.destroy(!0)}};var Ir=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],et,tt;function Ur(o,e,t){t===void 0&&!e.startsWith("data:")?o.crossOrigin=Or(e):t!==!1&&(o.crossOrigin=typeof t=="string"?t:"anonymous")}function Dr(o){return new Promise((e,t)=>{o.addEventListener("canplaythrough",r),o.addEventListener("error",s),o.load();function r(){i(),e()}function s(n){i(),t(n)}function i(){o.removeEventListener("canplaythrough",r),o.removeEventListener("error",s)}})}function Or(o,e=globalThis.location){if(o.startsWith("data:"))return"";e||(e=globalThis.location);let t=new URL(o,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function Wr(){let o=[],e=[];for(let t of Ir){let r=he.MIME_TYPES[t.substring(1)]||`video/${t.substring(1)}`;Y(r)&&(o.push(t),e.includes(r)||e.push(r))}return{validVideoExtensions:o,validVideoMime:e}}var Zt={name:"loadVideo",id:"video",extension:{type:d.LoadParser,name:"loadVideo"},test(o){if(!et||!tt){let{validVideoExtensions:r,validVideoMime:s}=Wr();et=r,tt=s}let e=G(o,tt),t=M(o,et);return e||t},async load(o,e,t){let r=x(te(x({},he.defaultOptions),{resolution:e.data?.resolution||ae(o),alphaMode:e.data?.alphaMode||await wt()}),e.data),s=document.createElement("video"),i={preload:r.autoLoad!==!1?"auto":void 0,"webkit-playsinline":r.playsinline!==!1?"":void 0,playsinline:r.playsinline!==!1?"":void 0,muted:r.muted===!0?"":void 0,loop:r.loop===!0?"":void 0,autoplay:r.autoPlay!==!1?"":void 0};Object.keys(i).forEach(p=>{let l=i[p];l!==void 0&&s.setAttribute(p,l)}),r.muted===!0&&(s.muted=!0),Ur(s,o,r.crossorigin);let n=document.createElement("source"),a;if(r.mime)a=r.mime;else if(o.startsWith("data:"))a=o.slice(5,o.indexOf(";"));else if(!o.startsWith("blob:")){let p=o.split("?")[0].slice(o.lastIndexOf(".")+1).toLowerCase();a=he.MIME_TYPES[p]||`video/${p}`}return n.src=o,a&&(n.type=a),new Promise((p,l)=>{r.preload&&!r.autoPlay&&s.load(),s.addEventListener("canplay",m),s.addEventListener("error",c),n.addEventListener("error",c),s.appendChild(n);async function m(){let h=new he(te(x({},r),{resource:s}));f(),e.data.preload&&await Dr(s),p(ne(h,t,o))}function c(h){f(),l(h)}function f(){s.removeEventListener("canplay",m),s.removeEventListener("error",c),n.removeEventListener("error",c)}})},unload(o){o.destroy(!0)}};var Ue={extension:{type:d.ResolveParser,name:"resolveTexture"},test:Ie.test,parse:o=>({resolution:parseFloat($.RETINA_PREFIX.exec(o)?.[1]??"1"),format:o.split(".").pop(),src:o})};var er={extension:{type:d.ResolveParser,priority:-2,name:"resolveJson"},test:o=>$.RETINA_PREFIX.test(o)&&o.endsWith(".json"),parse:Ue.parse};var De=class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new $,this.loader=new Xt,this.cache=B,this._backgroundLoader=new Me(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){P("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let i=e.manifest;typeof i=="string"&&(i=await this.load(i)),this.resolver.addManifest(i)}let t=e.texturePreference?.resolution??1,r=typeof t=="number"?[t]:t,s=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:s,resolution:r}}),e.preferences&&this.setPreferences(e.preferences),e.loadOptions&&(this.loader.loadOptions=x(x({},this.loader.loadOptions),e.loadOptions))}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();let r=Ce(e),s=re(e).map(a=>{if(typeof a!="string"){let p=this.resolver.getAlias(a);return p.some(l=>!this.resolver.hasKey(l))&&this.add(a),Array.isArray(p)?p[0]:p}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),i=this.resolver.resolve(s),n=await this._mapLoadToResolve(i,t);return r?n[s[0]]:n}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let r=!1;typeof e=="string"&&(r=!0,e=[e]);let s=this.resolver.resolveBundle(e),i={},n=Object.keys(s),a=0,p=[],l=()=>{t?.(p.reduce((c,f)=>c+f,0)/a)},m=n.map((c,f)=>{let h=s[c],u=Object.values(h),g=[...new Set(u.flat())].reduce((T,W)=>T+(W.progressSize||1),0);return p.push(0),a+=g,this._mapLoadToResolve(h,T=>{p[f]=T*g,l()}).then(T=>{i[c]=T})});return await Promise.all(m),r?i[e[0]]:i}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);let t=this.resolver.resolveBundle(e);Object.values(t).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return B.get(e);let t={};for(let r=0;r<e.length;r++)t[r]=B.get(e[r]);return t}async _mapLoadToResolve(e,t){let r=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;let s=await this.loader.load(r,t);this._backgroundLoader.active=!0;let i={};return r.forEach(n=>{let a=s[n.src],p=[n.src];n.alias&&p.push(...n.alias),p.forEach(l=>{i[l]=a}),B.set(p,a)}),i}async unload(e){this._initialized||await this.init();let t=re(e).map(s=>typeof s!="string"?s.src:s),r=this.resolver.resolve(t);await this._unloadFromResolved(r)}async unloadBundle(e){this._initialized||await this.init(),e=re(e);let t=this.resolver.resolveBundle(e),r=Object.keys(t).map(s=>this._unloadFromResolved(t[s]));await Promise.all(r)}async _unloadFromResolved(e){let t=Object.values(e);t.forEach(r=>{B.remove(r.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(let r of e.detections)e.skipDetections||await r.test()?t=await r.add(t):e.skipDetections||(t=await r.remove(t));return t=t.filter((r,s)=>t.indexOf(r)===s),t}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(r=>r in e).forEach(r=>{t.config[r]=e[r]})})}},R=new De;A.handleByList(d.LoadParser,R.loader.parsers).handleByList(d.ResolveParser,R.resolver.parsers).handleByList(d.CacheParser,R.cache.parsers).handleByList(d.DetectionParser,R.detections);A.add(Dt,Vt,Ot,jt,Ht,zt,Nt,qt,Kt,$t,Yt,Ie,Zt,Ut,It,Ue,er);var tr={loader:d.LoadParser,resolver:d.ResolveParser,cache:d.CacheParser,detection:d.DetectionParser};A.handle(d.Asset,o=>{let e=o.ref;Object.entries(tr).filter(([t])=>!!e[t]).forEach(([t,r])=>A.add(Object.assign(e[t],{extension:e[t].extension??r})))},o=>{let e=o.ref;Object.keys(tr).filter(t=>!!e[t]).forEach(t=>A.remove(e[t]))});var Oe=class extends _t{constructor(e,t){let c=e,{text:r,resolution:s,style:i,anchor:n,width:a,height:p,roundPixels:l}=c,m=be(c,["text","resolution","style","anchor","width","height","roundPixels"]);super(x({},m)),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=t,this.text=r??"",this.style=i,this.resolution=s??null,this.allowChildren=!1,this._anchor=new vt({_onUpdate:()=>{this.onViewUpdate()}}),n&&(this.anchor=n),this.roundPixels=l??!1,a!==void 0&&(this.width=a),p!==void 0&&(this.height=p)}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}set text(e){e=e.toString(),this._text!==e&&(this._text=e,this.onViewUpdate())}get text(){return this._text}set resolution(e){this._autoResolution=e===null,this._resolution=e,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(e){e||(e={}),this._style?.off("update",this.onViewUpdate,this),e instanceof this._styleClass?this._style=e:this._style=new this._styleClass(e),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(e){this._setWidth(e,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(e){this._setHeight(e,this.bounds.height)}getSize(e){return e||(e={}),e.width=Math.abs(this.scale.x)*this.bounds.width,e.height=Math.abs(this.scale.y)*this.bounds.height,e}setSize(e,t){typeof e=="object"?(t=e.height??e.width,e=e.width):t??(t=e),e!==void 0&&this._setWidth(e,this.bounds.width),t!==void 0&&this._setHeight(t,this.bounds.height)}containsPoint(e){let t=this.bounds.width,r=this.bounds.height,s=-t*this.anchor.x,i=0;return e.x>=s&&e.x<=s+t&&(i=-r*this.anchor.y,e.y>=i&&e.y<=i+r)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(e=!1){super.destroy(e),this.owner=null,this._bounds=null,this._anchor=null,(typeof e=="boolean"?e:e?.style)&&this._style.destroy(e),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}};function rr(o,e){let t=o[0]??{};return(typeof t=="string"||o[1])&&(K(fe,`use new ${e}({ text: "hi!", style }) instead`),t={text:t,style:o[1]}),t}var oe=null,X=null;function Vr(o,e){oe||(oe=y.get().createCanvas(256,128),X=oe.getContext("2d",{willReadFrequently:!0}),X.globalCompositeOperation="copy",X.globalAlpha=1),(oe.width<o||oe.height<e)&&(oe.width=ze(o),oe.height=ze(e))}function or(o,e,t){for(let r=0,s=4*t*e;r<e;++r,s+=4)if(o[s+3]!==0)return!1;return!0}function sr(o,e,t,r,s){let i=4*e;for(let n=r,a=r*i+4*t;n<=s;++n,a+=i)if(o[a+3]!==0)return!1;return!0}function ir(...o){let e=o[0];e.canvas||(e={canvas:o[0],resolution:o[1]});let{canvas:t}=e,r=Math.min(e.resolution??1,1),s=e.width??t.width,i=e.height??t.height,n=e.output;if(Vr(s,i),!X)throw new TypeError("Failed to get canvas 2D context");X.drawImage(t,0,0,s,i,0,0,s*r,i*r);let p=X.getImageData(0,0,s,i).data,l=0,m=0,c=s-1,f=i-1;for(;m<i&&or(p,s,m);)++m;if(m===i)return de.EMPTY;for(;or(p,s,f);)--f;for(;sr(p,s,l,m,f);)++l;for(;sr(p,s,c,m,f);)--c;return++c,++f,X.globalCompositeOperation="source-over",X.strokeRect(l,m,c-l,f-m),X.globalCompositeOperation="copy",n??(n=new de),n.set(l/r,m/r,(c-l)/r,(f-m)/r),n}var ar=new de,rt=class{getCanvasAndContext(e){let{text:t,style:r,resolution:s=1}=e,i=r._getFinalPadding(),n=D.measureText(t||" ",r),a=Math.ceil(Math.ceil(Math.max(1,n.width)+i*2)*s),p=Math.ceil(Math.ceil(Math.max(1,n.height)+i*2)*s),l=je.getOptimalCanvasAndContext(a,p);this._renderTextToCanvas(r,i,s,l,n);let m=r.trim?ir({canvas:l.canvas,width:a,height:p,resolution:1,output:ar}):ar.set(0,0,a,p);return{canvasAndContext:l,frame:m}}returnCanvasAndContext(e){je.returnCanvasAndContext(e)}_renderTextToCanvas(e,t,r,s,i){if(i.runsByLine&&i.runsByLine.length>0){this._renderTaggedTextToCanvas(i,e,t,r,s);return}let{canvas:n,context:a}=s,p=Xe(e),l=i.lines,m=i.lineHeight,c=i.lineWidths,f=i.maxLineWidth,h=i.fontProperties,u=n.height;if(a.resetTransform(),a.scale(r,r),a.textBaseline=e.textBaseline,e._stroke?.width){let w=e._stroke;a.lineWidth=w.width,a.miterLimit=w.miterLimit,a.lineJoin=w.join,a.lineCap=w.cap}a.font=p;let S,g,T=e.dropShadow?2:1,W=e.wordWrap?e.wordWrapWidth:f,_=(e._stroke?.width??0)/2,V=(m-h.fontSize)/2;m-h.fontSize<0&&(V=0);for(let w=0;w<T;++w){let H=e.dropShadow&&w===0,k=H?Math.ceil(Math.max(1,u)+t*2):0,z=k*r;if(H)this._setupDropShadow(a,e,r,z);else{let b=e._gradientBounds,J=e._gradientOffset;if(b){let Ve={width:b.width,height:b.height,lineHeight:b.height,lines:i.lines};this._setFillAndStrokeStyles(a,e,Ve,t,_,J?.x??0,J?.y??0)}else J?this._setFillAndStrokeStyles(a,e,i,t,_,J.x,J.y):this._setFillAndStrokeStyles(a,e,i,t,_);a.shadowColor="black"}for(let b=0;b<l.length;b++)S=_,g=_+b*m+h.ascent+V,S+=this._getAlignmentOffset(c[b],W,e.align),e._stroke?.width&&this._drawLetterSpacing(l[b],e,s,S+t,g+t-k,!0),e._fill!==void 0&&this._drawLetterSpacing(l[b],e,s,S+t,g+t-k)}}_renderTaggedTextToCanvas(e,t,r,s,i){let{canvas:n,context:a}=i,{runsByLine:p,lineWidths:l,maxLineWidth:m,lineAscents:c,lineHeights:f,hasDropShadow:h}=e,u=n.height;a.resetTransform(),a.scale(s,s),a.textBaseline=t.textBaseline;let S=h?2:1,g=t.wordWrap?t.wordWrapWidth:m,W=(t._stroke?.width??0)/2,se=[];for(let _=0;_<p.length;_++){let V=p[_],w=[];for(let H of V){let k=Xe(H.style);a.font=k,w.push({width:D._measureText(H.text,H.style.letterSpacing,a),font:k})}se.push(w)}for(let _=0;_<S;++_){let V=h&&_===0,w=V?Math.ceil(Math.max(1,u)+r*2):0,H=w*s;V||(a.shadowColor="black");let k=W;for(let z=0;z<p.length;z++){let b=p[z],J=l[z],Ve=c[z],mr=f[z],ot=se[z],He=W;He+=this._getAlignmentOffset(J,g,t.align);let st=k+Ve,N=He+r;for(let j=0;j<b.length;j++){let v=b[j],{width:Z,font:ce}=ot[j];if(a.font=ce,a.textBaseline=v.style.textBaseline,v.style._stroke?.width){let ee=v.style._stroke;if(a.lineWidth=ee.width,a.miterLimit=ee.miterLimit,a.lineJoin=ee.join,a.lineCap=ee.cap,V)if(v.style.dropShadow)this._setupDropShadow(a,v.style,s,H);else{N+=Z;continue}else{let Ae=D.measureFont(ce),Se=v.style.lineHeight||Ae.fontSize,cr={width:Z,height:Se,lineHeight:Se,lines:[v.text]};a.strokeStyle=ue(ee,a,cr,r*2,N-r,k)}this._drawLetterSpacing(v.text,v.style,i,N,st+r-w,!0)}N+=Z}N=He+r;for(let j=0;j<b.length;j++){let v=b[j],{width:Z,font:ce}=ot[j];if(a.font=ce,a.textBaseline=v.style.textBaseline,v.style._fill!==void 0){if(V)if(v.style.dropShadow)this._setupDropShadow(a,v.style,s,H);else{N+=Z;continue}else{let ee=D.measureFont(ce),Ae=v.style.lineHeight||ee.fontSize,Se={width:Z,height:Ae,lineHeight:Ae,lines:[v.text]};a.fillStyle=ue(v.style._fill,a,Se,r*2,N-r,k)}this._drawLetterSpacing(v.text,v.style,i,N,st+r-w,!1)}N+=Z}k+=mr}}}_setFillAndStrokeStyles(e,t,r,s,i,n=0,a=0){if(e.fillStyle=t._fill?ue(t._fill,e,r,s*2,n,a):null,t._stroke?.width){let p=i+s*2;e.strokeStyle=ue(t._stroke,e,r,p,n,a)}}_setupDropShadow(e,t,r,s){e.fillStyle="black",e.strokeStyle="black";let i=t.dropShadow,n=i.color,a=i.alpha;e.shadowColor=yt.shared.setValue(n).setAlpha(a).toRgbaString();let p=i.blur*r,l=i.distance*r;e.shadowBlur=p,e.shadowOffsetX=Math.cos(i.angle)*l,e.shadowOffsetY=Math.sin(i.angle)*l+s}_getAlignmentOffset(e,t,r){return r==="right"?t-e:r==="center"?(t-e)/2:0}_drawLetterSpacing(e,t,r,s,i,n=!1){let{context:a}=r,p=t.letterSpacing,l=!1;if(D.experimentalLetterSpacingSupported&&(D.experimentalLetterSpacing?(a.letterSpacing=`${p}px`,a.textLetterSpacing=`${p}px`,l=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),p===0||l){n?a.strokeText(e,s,i):a.fillText(e,s,i);return}let m=s,c=D.graphemeSegmenter(e),f=a.measureText(e).width,h=0;for(let u=0;u<c.length;++u){let S=c[u];n?a.strokeText(S,m,i):a.fillText(S,m,i);let g="";for(let T=u+1;T<c.length;++T)g+=c[T];h=a.measureText(g).width,m+=f-h+p,f=h}}},Q=new rt;function nr(o,e){let{texture:t,bounds:r}=o,s=e._style._getFinalPadding();bt(r,e._anchor,t);let i=e._anchor._x*s*2,n=e._anchor._y*s*2;r.minX-=s-i,r.minY-=s-n,r.maxX-=s-i,r.maxY-=s-n}var We=class extends Ct{};var ye=class{constructor(e){this._renderer=e,e.runners.resolutionChange.add(this),this._managedTexts=new Pt({renderer:e,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"canvasText"})}resolutionChange(){for(let e in this._managedTexts.items){let t=this._managedTexts.items[e];t?._autoResolution&&t.onViewUpdate()}}validateRenderable(e){let t=this._getGpuText(e),r=e.styleKey;return t.currentKey!==r?!0:e._didTextUpdate}addRenderable(e,t){let r=this._getGpuText(e);if(e._didTextUpdate){let s=e._autoResolution?this._renderer.resolution:e.resolution;(r.currentKey!==e.styleKey||e._resolution!==s)&&this._updateGpuText(e),e._didTextUpdate=!1,nr(r,e)}this._renderer.renderPipes.batch.addToBatch(r,t)}updateRenderable(e){let t=this._getGpuText(e);t._batcher.updateElement(t)}_updateGpuText(e){let t=this._getGpuText(e);t.texture&&this._renderer.canvasText.decreaseReferenceCount(t.currentKey),e._resolution=e._autoResolution?this._renderer.resolution:e.resolution,t.texture=this._renderer.canvasText.getManagedTexture(e),t.currentKey=e.styleKey}_getGpuText(e){return e._gpuData[this._renderer.uid]||this.initGpuText(e)}initGpuText(e){let t=new We;return t.currentKey="--",t.renderable=e,t.transform=e.groupTransform,t.bounds={minX:0,maxX:1,minY:0,maxY:0},t.roundPixels=this._renderer._roundPixels|e._roundPixels,e._gpuData[this._renderer.uid]=t,this._managedTexts.add(e),t}onTextUnload(e){let t=e._gpuData[this._renderer.uid];if(!t)return;let{canvasText:r}=this._renderer;r.getReferenceCount(t.currentKey)>0?r.decreaseReferenceCount(t.currentKey):t.texture&&r.returnTexture(t.texture)}destroy(){this._managedTexts.destroy(),this._renderer=null}};ye.extension={type:[d.WebGLPipes,d.WebGPUPipes,d.CanvasPipes],name:"text"};var Hr=new Tt;function pr(o,e,t,r){let s=Hr;s.minX=0,s.minY=0,s.maxX=o.width/r|0,s.maxY=o.height/r|0;let i=we.getOptimalTexture(s.width,s.height,r,!1);return i.source.uploadMethodId="image",i.source.resource=o,i.source.alphaMode="premultiply-alpha-on-upload",i.frame.width=e/r,i.frame.height=t/r,i.source.emit("update",i.source),i.updateUvs(),i}var me=class{constructor(e,t){this._activeTextures={},this._renderer=e,this._retainCanvasContext=t}getTexture(e,t,r,s){typeof e=="string"&&(K("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),e={text:e,style:r,resolution:t}),e.style instanceof O||(e.style=new O(e.style)),e.textureStyle instanceof ie||(e.textureStyle=new ie(e.textureStyle)),typeof e.text!="string"&&(e.text=e.text.toString());let{text:i,style:n,textureStyle:a}=e,p=e.resolution??this._renderer.resolution,{frame:l,canvasAndContext:m}=Q.getCanvasAndContext({text:i,style:n,resolution:p}),c=pr(m.canvas,l.width,l.height,p);if(a&&(c.source.style=a),n.trim&&(l.pad(n.padding),c.frame.copyFrom(l),c.frame.scale(1/p),c.updateUvs()),n.filters){let f=this._applyFilters(c,n.filters);return this.returnTexture(c),Q.returnCanvasAndContext(m),f}return this._renderer.texture.initSource(c._source),this._retainCanvasContext||Q.returnCanvasAndContext(m),c}returnTexture(e){let t=e.source,r=t.resource;if(this._retainCanvasContext&&r?.getContext){let s=r.getContext("2d");s&&Q.returnCanvasAndContext({canvas:r,context:s})}t.resource=null,t.uploadMethodId="unknown",t.alphaMode="no-premultiply-alpha",we.returnTexture(e,!0)}renderTextToCanvas(){K("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}getManagedTexture(e){e._resolution=e._autoResolution?this._renderer.resolution:e.resolution;let t=e.styleKey;if(this._activeTextures[t])return this._increaseReferenceCount(t),this._activeTextures[t].texture;let r=this.getTexture({text:e.text,style:e.style,resolution:e._resolution,textureStyle:e.textureStyle});return this._activeTextures[t]={texture:r,usageCount:1},r}decreaseReferenceCount(e){let t=this._activeTextures[e];t&&(t.usageCount--,t.usageCount===0&&(this.returnTexture(t.texture),this._activeTextures[e]=null))}getReferenceCount(e){return this._activeTextures[e]?.usageCount??0}_increaseReferenceCount(e){this._activeTextures[e].usageCount++}_applyFilters(e,t){let r=this._renderer.renderTarget.renderTarget,s=this._renderer.filter.generateFilteredTexture({texture:e,filters:t});return this._renderer.renderTarget.bind(r,!1),s}destroy(){this._renderer=null;for(let e in this._activeTextures)this._activeTextures[e]&&this.returnTexture(this._activeTextures[e].texture);this._activeTextures=null}};var ve=class extends me{constructor(e){super(e,!0)}};ve.extension={type:[d.CanvasSystem],name:"canvasText"};var Te=class extends me{constructor(e){super(e,!1)}};Te.extension={type:[d.WebGLSystem,d.WebGPUSystem],name:"canvasText"};A.add(ve);A.add(Te);A.add(ye);var q=class extends Oe{constructor(...e){let t=rr(e,"Text");super(t,O),this.renderPipeId="text",t.textureStyle&&(this.textureStyle=t.textureStyle instanceof ie?t.textureStyle:new ie(t.textureStyle))}updateBounds(){let e=this._bounds,t=this._anchor,r=0,s=0;if(this._style.trim){let{frame:i,canvasAndContext:n}=Q.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Q.returnCanvasAndContext(n),r=i.width,s=i.height}else{let i=D.measureText(this._text,this._style);r=i.width,s=i.height}e.minX=-t._x*r,e.maxX=e.minX+r,e.minY=-t._y*s,e.maxY=e.minY+s}};A.add(Et,Lt);var zr=["pixiContainer"],lr=class o{constructor(e,t,r){this.router=e;this.gameState=t;this.assetLoader=r}pixiContainer;app;bgLayer;gameContainer;charLayer;uiLayer;overlayLayer;snehal;apoorv;bouquet;dialogueBox;dialogueText;yesBtn;noBtn;endMenu;dialogueIndex=0;dialogueLines=[];assets={};initDialogueLines(){let e=this.gameState.memoryWords();console.log("FinalCutscene Words:",e);let t=e.join(", ")||"warmth, depth, sunshine";this.dialogueLines=["Explorer Snehal\u2026 you made it.","The sky looks extra soft tonight.","I hope the adventure was fun, because I\u2019m genuinely proud of you.",`And you chose, ${t}`,"That\u2019s you. And that\u2019s only a small piece of what I see in you.","Never forget this, you are deeply loved.","You cleared the foggy forest. Promise me you\u2019ll choose your peace first.","Because you matter to me the most.","You conquered the Vibe Detector.","I hope that clarity follows you, everywhere.","And I wanted to give you that bouquet again, virtual this time.","","Finally, I\u2019ve been carrying something in my chest.","I dont need loud love for days. I want steady love for years.","So here\u2019s my real question\u2026","Will you hold my hand, and be mine, forever?"]}async ngAfterViewInit(){this.initDialogueLines(),this.gameState.showHud.set(!1),this.app=new Le,await this.app.init({resizeTo:window,backgroundColor:0,resolution:window.devicePixelRatio||1,autoDensity:!0}),this.pixiContainer.nativeElement.appendChild(this.app.canvas),await this.loadAssets(),this.setupScene(),this.renderBeat(0),this.handleResize()}async loadAssets(){let e=Date.now(),t=m=>`${this.assetLoader.get(m)}?t=${e}`,r=t("bg_observatory.jpg"),s=t("snehal_happy.png"),i=t("snehal_holding_bouquet.png"),n=t("apoorv_final.png"),a=t("proposal.png"),p=t("bouquet_sunflower_rose.png"),l=t("valentines_end.png");console.log("Loading assets from:",r);try{let m=await R.load(r);this.assets.bg=m}catch(m){console.error("Failed to load bg",m)}try{this.assets.snehal=await R.load(s)}catch{}try{this.assets.snehal_bouquet=await R.load(i)}catch{}try{this.assets.apoorv_happy=await R.load(n)}catch{}try{this.assets.apoorv_kneel=await R.load(a)}catch{}try{this.assets.ending=await R.load(l)}catch{}}setupScene(){if(this.bgLayer=new C,this.gameContainer=new C,this.charLayer=new C,this.uiLayer=new C,this.overlayLayer=new C,this.gameContainer.addChild(this.charLayer,this.uiLayer,this.overlayLayer),this.app.stage.addChild(this.bgLayer,this.gameContainer),this.assets.bg){let r=F.from(this.assets.bg);r.anchor.set(.5),this.bgLayer.addChild(r)}else{console.warn("Using Fallback BG (Red)");let r=new U;r.rect(-50,-50,100,100),r.fill(5570560),this.bgLayer.addChild(r)}if(this.assets.snehal){this.snehal=F.from(this.assets.snehal);let r=Math.min(720/this.snehal.texture.height*.45,1);this.snehal.scale.set(r)}else this.snehal=new F(I.WHITE),this.snehal.tint=16738740,this.snehal.width=100,this.snehal.height=200;if(this.snehal.anchor.set(.5,1),this.snehal.x=1280*.72,this.snehal.y=600,this.snehal.visible=!1,this.charLayer.addChild(this.snehal),this.assets.apoorv_happy){this.apoorv=F.from(this.assets.apoorv_happy);let r=this.apoorv.texture.height,i=720*.45+30,n=Math.min(i/r,1.5);this.apoorv.scale.set(n)}else this.apoorv=new F(I.WHITE),this.apoorv.tint=8900331,this.apoorv.width=100,this.apoorv.height=200;this.apoorv.anchor.set(.5,1),this.apoorv.x=1280*.28,this.apoorv.y=600,this.apoorv.visible=!1,this.charLayer.addChild(this.apoorv),this.assets.bouquet?(this.bouquet=F.from(this.assets.bouquet),this.bouquet.scale.set(.5)):(this.bouquet=new F(I.WHITE),this.bouquet.tint=16766720,this.bouquet.width=80,this.bouquet.height=80),this.bouquet.anchor.set(.5,.5),this.bouquet.x=1280*.68,this.bouquet.y=720*.5,this.bouquet.visible=!1,this.uiLayer.addChild(this.bouquet),this.dialogueBox=new U,this.dialogueBox.roundRect(0,0,1280*.88,150,20),this.dialogueBox.fill({color:16777215,alpha:.9}),this.dialogueBox.stroke({width:4,color:16761035}),this.dialogueBox.x=(1280-1280*.88)/2,this.dialogueBox.y=720*.76,this.uiLayer.addChild(this.dialogueBox);let e=new O({fontFamily:"Arial",fontSize:32,fontStyle:"italic",fontWeight:"bold",fill:"#4a4a4a",wordWrap:!0,wordWrapWidth:1280*.8,align:"center",leading:4});this.dialogueText=new q({text:"",style:e}),this.dialogueText.anchor.set(.5,.5),this.dialogueText.x=1280/2,this.dialogueText.y=this.dialogueBox.y+75,this.uiLayer.addChild(this.dialogueText);let t=new U;t.rect(-5e3,-5e3,1e4,1e4),t.fill({color:0,alpha:1e-4}),t.eventMode="static",t.cursor="pointer",t.on("pointerdown",()=>this.advanceDialogue()),this.bgLayer.addChild(t),this.createButtons()}createButtons(){this.yesBtn=new C;let e=new U;e.roundRect(0,0,250,80,40),e.fill(15277667),e.stroke({width:4,color:16777215});let t=new O({fontFamily:"Georgia",fontSize:36,fontWeight:"bold",fontStyle:"italic",fill:"white",dropShadow:{color:"#000000",blur:4,angle:Math.PI/6,distance:2}}),r=new q({text:"Yes, I will",style:t});r.anchor.set(.5),r.x=125,r.y=40,this.yesBtn.addChild(e,r),this.yesBtn.x=1280/2-200,this.yesBtn.y=520,this.yesBtn.eventMode="static",this.yesBtn.cursor="pointer",this.yesBtn.visible=!1,this.yesBtn.on("pointerdown",a=>{a.stopPropagation(),this.handleYes()}),this.noBtn=new C;let s=new U;s.roundRect(0,0,150,60,30),s.fill(8421504);let i=new O({fontFamily:"Georgia",fontSize:28,fontStyle:"italic",fill:"white"}),n=new q({text:"No",style:i});n.anchor.set(.5),n.x=75,n.y=30,this.noBtn.addChild(s,n),this.noBtn.x=1280/2+150,this.noBtn.y=530,this.noBtn.eventMode="static",this.noBtn.visible=!1,this.app.ticker.add(()=>{if(!this.noBtn.visible)return;let a=this.app.renderer.events.pointer,p={x:a.x,y:a.y},l=this.gameContainer.toLocal(p),m=this.noBtn.x+75,c=this.noBtn.y+30,f=l.x-m,h=l.y-c;if(Math.sqrt(f*f+h*h)<100){let g=Math.atan2(h,f);this.noBtn.x-=Math.cos(g)*8,this.noBtn.y-=Math.sin(g)*8,this.noBtn.x=Math.max(50,Math.min(1230,this.noBtn.x)),this.noBtn.y=Math.max(50,Math.min(670,this.noBtn.y))}}),this.uiLayer.addChild(this.yesBtn,this.noBtn)}renderBeat(e){if(e>=this.dialogueLines.length)return;let t=this.dialogueLines[e];this.dialogueText.text=t,this.dialogueText.alpha=0;let r=()=>{this.dialogueText.alpha<1&&(this.dialogueText.alpha+=.05,requestAnimationFrame(r))};if(r(),e===0&&this.snehal&&(this.snehal.visible=!0),e===1&&this.apoorv){this.apoorv.visible=!0,this.apoorv.alpha=0;let s=()=>{this.apoorv.alpha+=.05,this.apoorv.alpha<1&&requestAnimationFrame(s)};s()}e===11&&this.assets.snehal_bouquet&&(this.snehal.texture=this.assets.snehal_bouquet),e===15&&(this.apoorv&&(this.assets.apoorv_kneel?this.apoorv.texture=this.assets.apoorv_kneel:this.apoorv instanceof F&&this.apoorv.texture===I.WHITE&&(this.apoorv.height=150),this.apoorv.anchor.set(.5,1),this.apoorv.x=1280/2,this.apoorv.y=640,this.apoorv.scale.set(1)),this.snehal&&(this.snehal.visible=!1),setTimeout(()=>{this.yesBtn.visible=!0,this.noBtn.visible=!0},1e3))}advanceDialogue(){this.yesBtn.visible||this.dialogueIndex<this.dialogueLines.length-1&&(this.dialogueIndex++,this.renderBeat(this.dialogueIndex))}handleYes(){this.yesBtn.visible=!1,this.noBtn.visible=!1,this.dialogueBox.visible=!1,this.dialogueText.visible=!1,this.bgLayer.visible=!1,this.charLayer.visible=!1,this.bouquet&&(this.bouquet.visible=!1),this.launchConfetti();let e;this.assets.ending?e=F.from(this.assets.ending):(e=new F(I.WHITE),e.tint=16716947,e.width=1280,e.height=720),e.anchor.set(.5),e.x=1280/2,e.y=720/2;let t=Math.min(1280/e.texture.width,720/e.texture.height);e.scale.set(t*.8),this.overlayLayer.addChild(e);let r=t*.8,s=t,i=()=>{r<s&&(r+=.005,e.scale.set(r),requestAnimationFrame(i))};i(),setTimeout(()=>this.showEndMenu(),1500)}launchConfetti(){let e=[16738740,16766720,49151,16729344];for(let t=0;t<100;t++){let r=new U;r.rect(0,0,10,10),r.fill(e[Math.floor(Math.random()*e.length)]),r.x=Math.random()*1280,r.y=-50-Math.random()*500;let s=2+Math.random()*5,i=(Math.random()-.5)*.2;this.overlayLayer.addChild(r),this.app.ticker.add(n=>{r.y+=s,r.rotation+=i,r.y>720&&(r.y=-10,r.x=Math.random()*1280)})}}showEndMenu(){this.endMenu=new C;let e=new U;e.roundRect(0,0,250,60,30),e.fill(16777215),e.stroke({width:2,color:0});let t=new q({text:"Replay \u{1F504}",style:{fontSize:24}});t.anchor.set(.5),t.x=125,t.y=30;let r=new C;r.addChild(e,t),r.x=1280/2-260,r.y=600,r.eventMode="static",r.cursor="pointer",r.on("pointerdown",()=>this.replay());let s=new U;s.roundRect(0,0,250,60,30),s.fill(16738740);let i=new q({text:"Portfolio \u{1F3E0}",style:{fontSize:24,fill:"white"}});i.anchor.set(.5),i.x=125,i.y=30;let n=new C;n.addChild(s,i),n.x=1280/2+10,n.y=600,n.eventMode="static",n.cursor="pointer",n.on("pointerdown",()=>this.goHome()),this.endMenu.addChild(r,n),this.overlayLayer.addChild(this.endMenu)}replay(){this.gameState.resetGame(),this.router.navigate(["/valentine/start"])}goHome(){this.router.navigate(["/"])}handleResize(){if(!this.app||!this.bgLayer)return;this.app.renderer.resize(window.innerWidth,window.innerHeight);let e=this.app.screen.width,t=this.app.screen.height,r=this.bgLayer.children[0];if(r){let s=1280,i=720;r instanceof F&&r.texture?(s=r.texture.width,i=r.texture.height):(s=100,i=100);let n=Math.max(e/s,t/i);r.scale.set(n),r.x=e/2,r.y=t/2}if(this.gameContainer){let n=Math.min(e/1280,t/720);this.gameContainer.scale.set(n),this.gameContainer.x=(e-1280*n)/2,this.gameContainer.y=(t-720*n)/2}}ngOnDestroy(){this.app&&this.app.destroy(!0,{children:!0,texture:!0})}static \u0275fac=function(t){return new(t||o)(_e(ut),_e(xt),_e(gt))};static \u0275cmp=at({type:o,selectors:[["app-final-cutscene"]],viewQuery:function(t,r){if(t&1&&ct(zr,5),t&2){let s;ft(s=dt())&&(r.pixiContainer=s.first)}},hostBindings:function(t,r){t&1&&mt("resize",function(){return r.handleResize()},it)},decls:3,vars:0,consts:[["pixiContainer",""],[1,"w-full","h-screen","bg-black","overflow-hidden"],[1,"w-full","h-full"]],template:function(t,r){t&1&&(nt(0,"div",1),lt(1,"div",2,0),pt())},dependencies:[ht],styles:["[_nghost-%COMP%]{display:block}"]})};export{lr as FinalCutsceneComponent};
